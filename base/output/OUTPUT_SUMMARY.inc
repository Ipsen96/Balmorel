*Create output file for NMBU
* adaptions to the original by tilseb@dtu.dk; Aug. 2019
* modified from FutureGas version. Remove Industry

SET CATEGORY /COSTS,REVENUE,PROFIT/;
SET SUBCATEGORY
/ELECTRICITY_SALE,HEAT_SALE,GENERATION_CAPITAL_COSTS,GENERATION_FIXED_COSTS,GENERATION_OPERATIONAL_COSTS,GENERATION_FUEL_COSTS,GENERATION_HYDRO,
 GENERATION_CO2_TAX,GENERATION_UC_COSTS,GENERATION_STEPWISE_RAMPING_COSTS, GENERATION_OTHER_EMI_TAX,GENERATION_TAXES,GENERATION_SUBSIDIES,GENERATION_GRID_TARIFFS,TRANSMISSION_CAPITAL_COSTS,TRANSMISSION_OPERATIONAL_COSTS,
 OTHER_FUEL_COSTS,OTHER_TRADE_INCOME,OTHER_TRADE_COSTS,CONSUMER_GRID_TARIFFS,CONSUMER_TAXES,TOTAL_PROFIT,ELECTRICITY_SPECIFIC_REVENUE,DISTRICT_HEAT_SPECIFIC_REVENUE
$ifi %DEMANDRESPONSE%==yes    , DEMAND_RESPONSE_COSTS
$ifi %EV%==yes    , EV_COSTS
/;
SET COMMODITY /ELECTRICITY,DISTRICT_HEAT,INDIVIDUAL_HEAT,SPACEHEAT,HOTWATER,PROCESS_HEAT/;
SET TECH_TYPE /DR_UP, DR_DOWN,CONDENSING,CHP-BACK-PRESSURE,CHP-EXTRACTION,BOILERS,GAS-DRIVEN-HP,ELECT-TO-HEAT,ELECT-HP,INTERSEASONAL-HEAT-STORAGE,INTERSEASONAL-ELECT-STORAGE,INTRASEASONAL-HEAT-STORAGE,INTRASEASONAL-ELECT-STORAGE,HYDRO-RESERVOIRS,HYDRO-RUN-OF-RIVER,WIND-ONSHORE,WIND-NEARSHORE,WIND-FARSHORE,SOLAR-PV-FARM,SOLAR-PV-COMMERCIAL,SOLAR-PV-RESIDENTIAL,SOLAR-PV,SOLAR-HEATING,HYDRO-WAVE/;
SET TECH_CATEGORY /THERMAL_POWER,CHP,BOILER,STORAGE,P2X,WIND,SOLAR-PV,SOLAR-HEAT,HYDRO/;
SET GTECH_TYPE(GGG,TECH_TYPE);
SET TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY);
SET PRICE_CATEGORY /AVERAGE,AVERAGE_WEIGHTED_BY_CONSUMPTION,AVERAGE_WEIGHTED_BY_PRODUCTION/;
SET VARIABLE_CATEGORY /EXOGENOUS,ENDOGENOUS,DECOMMISSIONING,EXOGENOUS_AC/;
SET EL_BAL_TYPE /CURTAILMENT,NETEXPORT,PRICE,DEMAND_EXO,DEMAND_LOSS,DEMAND_INTERSTO,DEMAND_INTRASTO,DEMAND_P2H,DEMAND_EV,CONDENSING,CHP-BACK-PRESSURE,CHP-EXTRACTION,ELECT-TO-HEAT,INTER-STO,INTRA-STO,HYDRO-RESERVOIRS,HYDRO-RUN-OF-RIVER,WIND-ONSHORE,WIND-OFFSHORE,HYDRO-WAVE/;
SET H_BAL_TYPE /CURTAILMENT,NETEXPORT,PRICE,DEMAND_EXO,DEMAND_LOSS,DEMAND_INTERSTO,DEMAND_INTRASTO,BOILERS,CHP-BACK-PRESSURE,CHP-EXTRACTION,INTER-STO,INTRA-STO,SOLAR-HEATING,P2H/;
SET UNITS /GW,TWh,MWh,Money_per_MWh,Mmoney,kton,GWh,Money_per_GJ,Money_per_tCO2, Money_per_tSO2,Money_per_kgNOx,tCO2_per_year,tSO2_per_year,kgNOx_per_year/;
SET EMISSION_TYPE /CO2,CH4,SO2,NOX/;
SET EUSER /OTHR,EV,P2X,HPandES_OTHER,P2H_IDVH,HP_IND/;
*"OTHR" EUSER represents the exogenous electricity demand of the following groups: RESE,PII and OTHER


* sets to allow for sector distinguishability
$ifi %INDHEAT%==yes SET INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE);
$ONMULTI
SET SECTOR
/POWER_DH,INDIVIDUAL_HEAT,DISTRICT_HEAT,STORAGE_LOSS,STORAGE_LOSS_LT,STORAGE_LOSS_ST
$ifi %EV%==yes    , EV_CHARGING, EV_DISCHARGING
/;
$OFFMULTI
SET INDUSTRY_AREAS(AAA) / /;

   GTECH_TYPE(G,'CONDENSING')$IGCND(G)                                                    = YES;
   GTECH_TYPE(G,'CHP-BACK-PRESSURE')$IGBPR(G)                                             = YES;
   GTECH_TYPE(G,'CHP-EXTRACTION')$IGEXT(G)                                                = YES;
   GTECH_TYPE(G,'BOILERS')$IGHOB(G)                                                       = YES;
   GTECH_TYPE(G,'ELECT-TO-HEAT')$IGETOH(G)                                                = YES;
   GTECH_TYPE(G,'INTRASEASONAL-HEAT-STORAGE')$IGHSTO(G)                                   = YES;
   GTECH_TYPE(G,'INTERSEASONAL-HEAT-STORAGE')$IGHSTOS(G)                                  = YES;
   GTECH_TYPE(G,'INTRASEASONAL-ELECT-STORAGE')$IGESTO(G)                                  = YES;
   GTECH_TYPE(G,'INTERSEASONAL-ELECT-STORAGE')$IGESTOS(G)                                 = YES;
   GTECH_TYPE(G,'HYDRO-RESERVOIRS')$IGHYRS(G)                                             = YES;
   GTECH_TYPE(G,'HYDRO-RUN-OF-RIVER')$IGHYRR(G)                                           = YES;
   GTECH_TYPE(G,'WIND-ONSHORE')$(IGWND(G)   AND GDATA(G,'GDTECHGROUP') EQ WINDTURBINE_ONSHORE)            = YES;
   GTECH_TYPE(G,'WIND-NEARSHORE')$(IGWND(G) AND GDATA(G,'GDTECHGROUP') EQ WINDTURBINE_OFFSHORE_NEARSHORE) = YES;
   GTECH_TYPE(G,'WIND-FARSHORE')$(IGWND(G)  AND GDATA(G,'GDTECHGROUP') EQ WINDTURBINE_OFFSHORE_FAR)       = YES;
   GTECH_TYPE(G,'SOLAR-PV-FARM')$(IGSOLE(G) AND GDATA(G,'GDTECHGROUP') EQ SOLARPV)                        = YES;
   GTECH_TYPE(G,'SOLAR-PV-COMMERCIAL')$(IGSOLE(G)  AND GDATA(G,'GDTECHGROUP')  EQ SOLARPV_COMMERCIAL)     = YES;
   GTECH_TYPE(G,'SOLAR-PV-RESIDENTIAL')$(IGSOLE(G) AND GDATA(G,'GDTECHGROUP')  EQ SOLARPV_RESIDENTIAL)    = YES;
   GTECH_TYPE(G,'SOLAR-HEATING')$IGSOLH(G)                                                = YES;
   GTECH_TYPE(G,'HYDRO-WAVE')$IGWAVE(G)                                                   = YES;

   TECH_TYPE_CATEGORY('CONDENSING','THERMAL_POWER')  = YES;
   TECH_TYPE_CATEGORY('CHP-BACK-PRESSURE','CHP')     = YES;
   TECH_TYPE_CATEGORY('CHP-EXTRACTION','CHP')        = YES;
   TECH_TYPE_CATEGORY('BOILERS','BOILER')            = YES;
   TECH_TYPE_CATEGORY('GAS-DRIVEN-HP','BOILER')      = YES;
   TECH_TYPE_CATEGORY('ELECT-TO-HEAT','P2X')         = YES;
   TECH_TYPE_CATEGORY('INTRASEASONAL-HEAT-STORAGE','STORAGE')         = YES;
   TECH_TYPE_CATEGORY('INTERSEASONAL-HEAT-STORAGE','STORAGE')         = YES;
   TECH_TYPE_CATEGORY('INTRASEASONAL-ELECT-STORAGE','STORAGE')        = YES;
   TECH_TYPE_CATEGORY('INTERSEASONAL-ELECT-STORAGE','STORAGE')        = YES;
   TECH_TYPE_CATEGORY('HYDRO-RESERVOIRS','HYDRO')    = YES;
   TECH_TYPE_CATEGORY('HYDRO-RUN-OF-RIVER','HYDRO')  = YES;
   TECH_TYPE_CATEGORY('HYDRO-WAVE','HYDRO')          = YES;
   TECH_TYPE_CATEGORY('WIND-ONSHORE','WIND')         = YES;
   TECH_TYPE_CATEGORY('WIND-NEARSHORE','WIND')       = YES;
   TECH_TYPE_CATEGORY('WIND-FARSHORE','WIND')        = YES;
   TECH_TYPE_CATEGORY('SOLAR-PV-FARM','SOLAR-PV')        = YES;
   TECH_TYPE_CATEGORY('SOLAR-PV-COMMERCIAL','SOLAR-PV')  = YES;
   TECH_TYPE_CATEGORY('SOLAR-PV-RESIDENTIAL','SOLAR-PV') = YES;
   TECH_TYPE_CATEGORY('SOLAR-HEATING','SOLAR-HEAT')  = YES;

PARAMETER G_CAP_YCRAF(Y,C,RRR,AAA,*,FFF,COMMODITY,TECH_TYPE,*,VARIABLE_CATEGORY,UNITS) "Generation capacity for each year, country, region, area, technology, fuel, commodity, technology type, variable type (GW)";
PARAMETER G_STO_YCRAF(Y,C,RRR,AAA,*,FFF,COMMODITY,TECH_TYPE,*,VARIABLE_CATEGORY,UNITS) "Generation storage for each year, country, region, area, technology, fuel, commodity, technology type and variable type (GWh)";
PARAMETER PRO_YCRAGFST(Y,C,RRR,AAA,G,FFF,SSS,TTT,COMMODITY,TECH_TYPE,TECH_CATEGORY,UNITS) "Energy Production for each year, country, region, area, technology, fuel, season, hour, commodity, technology type (MWh)" ;
PARAMETER PRO_YCRAGF(Y,C,RRR,AAA,*,FFF,*,TECH_TYPE,*,UNITS) "Annual Energy Production for each year, country, region, area, technology, fuel, commodity, technology type (TWh)";
PARAMETER F_CONS_YCRAST(Y,C,RRR,AAA,*,FFF,SSS,TTT,TECH_TYPE,*,SECTOR,UNITS) "Fuel consumption for each year, country, region, area, technology, fuel, season, hour and technology type (MWh)";
PARAMETER F_CONS_YCRA(Y,C,RRR,AAA,*,FFF,TECH_TYPE,*,SECTOR,UNITS) "Fuel consumption for each year, country, region, area, technology, fuel and technology type (TWh)";
PARAMETER X_CAP_YCR(Y,C,IRRRE,IRRRI,VARIABLE_CATEGORY,UNITS) "Transmission capacity for each year, country, from region to region (GW)";
PARAMETER X_FLOW_YCRST(Y,C,IRRRE,IRRRI,SSS,TTT,UNITS) "Transmission flow for each year, country, from region to region, for each season and hour (MWh)";
PARAMETER X_FLOW_YCR(Y,C,IRRRE,IRRRI,UNITS) "Transmission flow for each year, country, from region to region (TWh)";
PARAMETER ECO_G_YCRAG(Y,C,RRR,AAA,*,FFF,TECH_TYPE,*,CATEGORY,SUBCATEGORY,SECTOR,UNITS) "Generation Economic Output for each year, country, region, area and technology (Mmoney)";
PARAMETER ECO_X_YCR(Y,C,RRR,CATEGORY,SUBCATEGORY,UNITS) "Electric Transmission Economic Output for each year, country and region (Mmoney)";
PARAMETER OBJ_YCR(Y,C,RRR,SUBCATEGORY,SECTOR,UNITS) "Objective function (Mmoney)";
PARAMETER EL_PRICE_YCR(Y,C,RRR,PRICE_CATEGORY,UNITS) "Average Electricity Prices for each region (money/MWh)";
PARAMETER EL_PRICE_YCRST(Y,C,RRR,SSS,TTT,UNITS) "Hourly Electricity Prices for each region (money/MWh)";
PARAMETER DH_PRICE_YCRA(Y,C,RRR,AAA,PRICE_CATEGORY,UNITS) "Average District Heating Prices for each area(money/MWh)";
PARAMETER DH_PRICE_YCRAST(Y,C,RRR,AAA,SSS,TTT,UNITS) "Hourly District Heating Prices for each area (money(MWh)";

PARAMETER EL_DEMAND_YCRST(Y,C,RRR,SSS,TTT,VARIABLE_CATEGORY,SECTOR,UNITS) "Hourly Electricity Demand (MWh)";
PARAMETER EL_NET_DEMAND_YCRST(Y,C,RRR,SSS,TTT,DEUSER,UNITS) "Net electricity Demand (MWh)";
PARAMETER EL_DEMAND_YCR(Y,C,RRR,VARIABLE_CATEGORY,SECTOR,UNITS) "Yearly Electricity Demand (MWh)";
PARAMETER H_DEMAND_YCRAST(Y,C,RRR,AAA,COMMODITY,SSS,TTT,VARIABLE_CATEGORY,SECTOR,UNITS) "Hourly heat Demand (MWh)";
PARAMETER H_DEMAND_YCRA(Y,C,RRR,AAA,COMMODITY,VARIABLE_CATEGORY,SECTOR,UNITS) "Yearly heat Demand (MWh)";
PARAMETER EMI_YCRAG(Y,C,RRR,AAA,FFF,TECH_TYPE,*,EMISSION_TYPE,SECTOR,UNITS) "Annual CO2-EQUIVALENT emissions (ktons)";
PARAMETER CURT_YCRAGFST(Y,C,RRR,AAA,G,FFF,SSS,TTT,COMMODITY,TECH_TYPE,UNITS) "Hourly energy curtailment per country, region, area, technology, fuel, hour and technology type (MWh)";
PARAMETER CURT_YCRAGF(Y,C,RRR,AAA,G,FFF,COMMODITY,TECH_TYPE,UNITS) "Hourly energy curtailment per country, region, area, technology, fuel, hour and technology type (MWh)";
PARAMETER EL_BALANCE_YCRST(Y,C,RRR,EL_BAL_TYPE,SSS,TTT,UNITS);
PARAMETER H_BALANCE_YCRAST(Y,C,RRR,AAA,H_BAL_TYPE,SSS,TTT,UNITS);
PARAMETER FUEL_PRICE_YCRAF(Y,C,RRR,AAA,FFF,SECTOR,UNITS);
PARAMETER EMI_POLICY(Y,C,MPOLSET,SECTOR,UNITS);
PARAMETER EMI_POLICY_ALL(Y,MPOLSET,SECTOR,UNITS);
PARAMETER HEAT_STORAGE_VOLUME(Y,C,RRR,AAA,*,SSS,TTT,COMMODITY,TECH_TYPE,*,UNITS);
PARAMETER WEEKLY_HYDRO_STORAGE_VOLUME(Y,C,RRR,AAA,SSS,UNITS);

$ifi %Hydrogen%==yes PARAMETER GH2_T(Y,C,RRR,AAA,GGG,S,T) "Hydrogen production - existing plants (MWh)"  ;
$ifi not %INDHEAT%==yes $goto endindheat
PARAMETER IDVH_PRICE_YCRA(Y,C,RRR,INDHEAT_AAA,PRICE_CATEGORY,UNITS) "Average individual Heating Prices for each area(money/MWh)";
PARAMETER IDVH_PRICE_YCRAST(Y,C,RRR,INDHEAT_AAA,SSS,TTT,UNITS) "Hourly Individual Heating Prices for each area (money(MWh)";
PARAMETER PRO_IDVH_YCRAGFST(Y,C,RRR,INDHEAT_AAA,INDHEAT_G,FFF,SSS,TTT,INDHEAT_DHUSER,TECH_TYPE,INDHEAT_GROUP,UNITS) "Energy Production for each year, country, region, area, technology, fuel, season, hour, commodity, technology type (MWh)" ;

* individual heating generation technology types
*   INDHEAT_GTECH_TYPE(INDHEAT_G,'CHP-BACK-PRESSURE')             = YES$(INDHEAT_GDATA(INDHEAT_G,'GDTYPE') EQ GBPR);
*   INDHEAT_GTECH_TYPE(INDHEAT_G,'CHP-EXTRACTION')                = YES$(INDHEAT_GDATA(INDHEAT_G,'GDTYPE') EQ GEXT);
   INDHEAT_GTECH_TYPE(INDHEAT_G,'BOILERS')$(INDHEAT_IGHOB(INDHEAT_G) AND ( INDHEAT_GDATA(INDHEAT_G,'GDFE') LE 1))             = YES;
   INDHEAT_GTECH_TYPE(INDHEAT_G,'GAS-DRIVEN-HP')$(INDHEAT_IGHOB(INDHEAT_G) AND (INDHEAT_GDATA(INDHEAT_G,'GDFE') GT 1))             = YES;
   INDHEAT_GTECH_TYPE(INDHEAT_G,'ELECT-TO-HEAT')$INDHEAT_IGETOH_NOTHP(INDHEAT_G)      = YES;
   INDHEAT_GTECH_TYPE(INDHEAT_G,'ELECT-HP')$INDHEAT_IGHP(INDHEAT_G)      = YES;
   INDHEAT_GTECH_TYPE(INDHEAT_G,'INTRASEASONAL-HEAT-STORAGE')$INDHEAT_IGHSTO(INDHEAT_G)      = YES;
   INDHEAT_GTECH_TYPE(INDHEAT_G,'SOLAR-HEATING')$INDHEAT_IGSOLH(INDHEAT_G)      = YES;

$label endindheat

*Modification of IHOURSINST
$ifi %RollingSeasons%==yes PARAMETER IHOURSINTROLLINGSEASON(S,T) "Length of time segment (hours) used in rolling season mode";
$ifi %RollingSeasons%==yes IWEIGHSUMS=SUM(SSS$(ORD(SSS) LE ROLLINGSEASONSNUMBER), WEIGHT_S(SSS));
$ifi %RollingSeasons%==yes IHOURSINTROLLINGSEASON(S,T)=IOF8760*WEIGHT_S(S)*WEIGHT_T(T)/(IWEIGHSUMS*SUM(ITALIAS, WEIGHT_T(ITALIAS)))/IHOURFRAC;


IWEIGHSUMS = SUM(S, WEIGHT_S(S));
IWEIGHSUMT = SUM(T, WEIGHT_T(T));
IHOURSINST(SSS,TTT)=0;
IHOURSINST(S,T)=IOF8760*WEIGHT_S(S)*WEIGHT_T(T)/(IWEIGHSUMS*IWEIGHSUMT);

ALIAS(C,ALIAS_C);

* -------------------- ENERGY CAPACITY ---------------------

* ------------- ELECTRICITY CAPACITY --------------

** EXOGENOUS ELECTRICITY CAPACITY

G_CAP_YCRAF(Y,C,IR,IA,IGE,FFF,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'EXOGENOUS','GW')$((not IGETOH(IGE)) AND CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGE) AND IGF(IGE,FFF) AND GTECH_TYPE(IGE,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
         IOF0001*(GKFX(Y,IA,IGE)/(1$((NOT IGESTO(IGE)) AND (NOT IGESTOS(IGE)))+GDATA(IGE,'GDSTOHUNLD')$((IGESTO(IGE)) OR IGESTOS(IGE))));
** ENDOGENOUS ELECTRIC CAPACITY ACCUMULATED INVESTMENTS
G_CAP_YCRAF(Y,C,IR,IA,IGE,FFF,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'ENDOGENOUS','GW')$((not IGETOH(IGE)) AND CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGE) AND IGF(IGE,FFF) AND GTECH_TYPE(IGE,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
         IOF0001*(VGKNACCUMNET.L(Y,IA,IGE)/(1$((NOT IGESTO(IGE)) AND (NOT IGESTOS(IGE)))+GDATA(IGE,'GDSTOHUNLD')$((IGESTO(IGE)) OR IGESTOS(IGE))));
** ENDOGENOUS ELECTRICITY CAPACITY ACCUMULATED DECOMMISSIONING
$ifi %DECOM%==yes G_CAP_YCRAF(Y,C,IR,IA,IGE,FFF,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'DECOMMISSIONING','GW')$((not IGETOH(IGE)) AND CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGE) AND IGF(IGE,FFF) AND GTECH_TYPE(IGE,TECH_TYPE) AND IGDECOMEXOPOT(Y,IA,IGE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
$ifi %DECOM%==yes -IOF0001*(VDECOM_EXO_ACCUM.L(Y,IA,IGE)/(1$((NOT IGESTO(IGE)) AND (NOT IGESTOS(IGE)))+GDATA(IGE,'GDSTOHUNLD')$((IGESTO(IGE)) OR IGESTOS(IGE))));

* ------------- END OF ELECTRICITY CAPACITY --------------

* ------------- HEAT CAPACITY --------------

** EXOGENOUS HEAT CAPACITY
*** DISTRICT HEAT
G_CAP_YCRAF(Y,C,IR,IA,IGH,FFF,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'EXOGENOUS','GW')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
IOF0001*GKFX(Y,IA,IGH)/((1$((NOT IGHSTO(IGH)) AND (NOT IGHSTOS(IGH)))+GDATA(IGH,'GDSTOHUNLD')$((IGHSTO(IGH)) OR IGHSTOS(IGH)))*(GDATA(IGH,'GDCB')$IGBPR(IGH)+ (GDATA(IGH,'GDCB')+GDATA(IGH,'GDCV'))$IGEXT(IGH)+1$(NOT (IGBPR(IGH) OR IGEXT(IGH)))));

*** INDHEAT
$ifi %INDHEAT%==yes G_CAP_YCRAF(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,'INDIVIDUAL_HEAT',TECH_TYPE,INDHEAT_GROUP,'EXOGENOUS','GW')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) and (INDHEAT_GDATA(INDHEAT_G,'GDFUEL') EQ FDATA(FFF,'FDACRONYM')) AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
$ifi %INDHEAT%==yes          IOF0001*INDHEAT_GKFX(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)/(1$(NOT INDHEAT_IGHSTO(INDHEAT_G))+ INDHEAT_GDATA(INDHEAT_G,'GDSTOHUNLD')$(INDHEAT_IGHSTO(INDHEAT_G)));

*** INDUSTRY
***G_CAP_YCRAF(Y,C,IR,IA,IGH,FFF,'PROCESS_HEAT',TECH_TYPE,TECH_CATEGORY'EXOGENOUS','GW')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
***         IOF0001*(GKFX(Y,IA,IGH)/(1$((NOT IGHSTO(IGH)) AND (NOT IGHSTOS(IGH)))+GDATA(IGH,'GDSTOHUNLD')$((IGHSTO(IGH)) OR IGHSTOS(IGH))));


** ENDOGENOUS HEAT CAPACITY ACCUMULATED INVESTMENTS
*** DISTRICT HEAT
G_CAP_YCRAF(Y,C,IR,IA,IGH,FFF,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'ENDOGENOUS','GW')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
IOF0001*VGKNACCUMNET.L(Y,IA,IGH)/((1$((NOT IGHSTO(IGH)) AND (NOT IGHSTOS(IGH)))+GDATA(IGH,'GDSTOHUNLD')$((IGHSTO(IGH)) OR IGHSTOS(IGH)))*(GDATA(IGH,'GDCB')$IGBPR(IGH)+ (GDATA(IGH,'GDCB')+GDATA(IGH,'GDCV'))$IGEXT(IGH)+1$(NOT (IGBPR(IGH) OR IGEXT(IGH)))));

*** INDHEAT
$ifi %INDHEAT%==yes G_CAP_YCRAF(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,'INDIVIDUAL_HEAT',TECH_TYPE,INDHEAT_GROUP,'ENDOGENOUS','GW')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) and (INDHEAT_GDATA(INDHEAT_G,'GDFUEL') EQ FDATA(FFF,'FDACRONYM')) AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
$ifi %INDHEAT%==yes          IOF0001*INDHEAT_VGKNACCUMNET.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)/(1$(NOT INDHEAT_IGHSTO(INDHEAT_G))+ INDHEAT_GDATA(INDHEAT_G,'GDSTOHUNLD')$(INDHEAT_IGHSTO(INDHEAT_G)));

*** INDUSTRY
***G_CAP_YCRAF(Y,C,IR,IA,IGH,FFF,'PROCESS_HEAT',TECH_TYPE,TECH_CATEGORY,'ENDOGENOUS','GW')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
***         IOF0001*(VGKNACCUMNET.L(Y,IA,IGH)/(1$((NOT IGESTO(IGH)) AND (NOT IGESTOS(IGH)))+GDATA(IGH,'GDSTOHUNLD')$((IGESTO(IGH)) OR IGESTOS(IGH))));

** ENDOGENOUS HEAT CAPACITY ACCUMULATED DECOMMISSIONING
$ifi %DECOM%==yes G_CAP_YCRAF(Y,C,IR,IA,IGH,FFF,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'DECOMMISSIONING','GW')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND IGDECOMEXOPOT(Y,IA,IGH) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
$ifi %DECOM%==yes -IOF0001*VDECOM_EXO_ACCUM.L(Y,IA,IGH)/((1$((NOT IGHSTO(IGH)) AND (NOT IGHSTOS(IGH)))+GDATA(IGH,'GDSTOHUNLD')$((IGHSTO(IGH)) OR IGHSTOS(IGH)))*(GDATA(IGH,'GDCB')$IGBPR(IGH)+ (GDATA(IGH,'GDCB')+GDATA(IGH,'GDCV'))$IGEXT(IGH)+1$(NOT (IGBPR(IGH) OR IGEXT(IGH)))));


*** INDUSTRY
***$ifi %DECOM%==yes G_CAP_YCRAF(Y,C,IR,IA,IGH,FFF,'PROCESS_HEAT',TECH_TYPE,TECH_CATEGORY,'DECOMMISSIONING','GW')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND IGDECOMEXOPOT(Y,IA,IGH) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
***$ifi %DECOM%==yes -IOF0001*(VDECOM_EXO_ACCUM.L(Y,IA,IGH)/(1$((NOT IGESTO(IGH)) AND (NOT IGESTOS(IGH)))+GDATA(IGH,'GDSTOHUNLD')$((IGESTO(IGH)) OR IGESTOS(IGH))));

* ------------- END OF HEAT CAPACITY --------------

* ---------------- END OF ENERGY CAPACITY -----------------

* -------------------- ENERGY STORAGE ---------------------

* ------------- ELECTRICITY STORAGE --------------

** EXOGENOUS ELECTRICITY STORAGE

G_STO_YCRAF(Y,C,IR,IA,IGE,FFF,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'EXOGENOUS','GWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGE) AND IGF(IGE,FFF) AND GTECH_TYPE(IGE,TECH_TYPE) AND (IGESTO(IGE) OR IGESTOS(IGE)) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
IOF0001*GKFX(Y,IA,IGE)
;

** ENDOGENOUS ELECTRIC STORAGE ACCUMULATED INVESTMENTS
G_STO_YCRAF(Y,C,IR,IA,IGE,FFF,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'ENDOGENOUS','GWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGE) AND IGF(IGE,FFF) AND GTECH_TYPE(IGE,TECH_TYPE) AND (IGESTO(IGE) OR IGESTOS(IGE)) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
IOF0001*VGKNACCUMNET.L(Y,IA,IGE)
;

** ENDOGENOUS ELECTRICITY STORAGE ACCUMULATED DECOMMISSIONING
$ifi %DECOM%==yes G_STO_YCRAF(Y,C,IR,IA,IGE,FFF,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'DECOMMISSIONING','GWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGE) AND IGF(IGE,FFF) AND GTECH_TYPE(IGE,TECH_TYPE) AND IGDECOMEXOPOT(Y,IA,IGE) AND (IGESTO(IGE) OR IGESTOS(IGE)) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
$ifi %DECOM%==yes -IOF0001*VDECOM_EXO_ACCUM.L(Y,IA,IGE)
;


* ------------- END OF ELECTRICITY CAPACITY --------------

* ------------- HEAT STORAGE --------------

** EXOGENOUS HEAT STORAGE

G_STO_YCRAF(Y,C,IR,IA,IGH,FFF,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'EXOGENOUS','GWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND (IGHSTO(IGH) OR IGHSTOS(IGH)) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
IOF0001*GKFX(Y,IA,IGH)
;
*** INDHEAT
$ifi %INDHEAT%==yes G_STO_YCRAF(Y,C,IR,INDHEAT_IA,INDHEAT_IGHSTO,FFF,'INDIVIDUAL_HEAT',TECH_TYPE,INDHEAT_GROUP,'EXOGENOUS','GWh')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_IGHSTO,INDHEAT_GROUP) AND INDHEAT_IGF(INDHEAT_IGHSTO,FFF) AND INDHEAT_GTECH_TYPE(INDHEAT_IGHSTO,TECH_TYPE))=
$ifi %INDHEAT%==yes          IOF0001*(INDHEAT_GKFX(Y,INDHEAT_IA,INDHEAT_IGHSTO,INDHEAT_GROUP));

** ENDOGENOUS HEAT STORAGE ACCUMULATED INVESTMENTS
G_STO_YCRAF(Y,C,IR,IA,IGH,FFF,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'ENDOGENOUS','GWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND (IGHSTO(IGH) OR IGHSTOS(IGH)) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
IOF0001*VGKNACCUMNET.L(Y,IA,IGH)
;
*** INDHEAT
$ifi %INDHEAT%==yes G_STO_YCRAF(Y,C,IR,INDHEAT_IA,INDHEAT_IGHSTO,FFF,'INDIVIDUAL_HEAT',TECH_TYPE,INDHEAT_GROUP,'ENDOGENOUS','GWh')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_IGHSTO,INDHEAT_GROUP) AND INDHEAT_IGF(INDHEAT_IGHSTO,FFF) AND INDHEAT_GTECH_TYPE(INDHEAT_IGHSTO,TECH_TYPE))=
$ifi %INDHEAT%==yes          IOF0001*(INDHEAT_VGKNACCUMNET.L(Y,INDHEAT_IA,INDHEAT_IGHSTO,INDHEAT_GROUP));

** ENDOGENOUS HEAT STORAGE ACCUMULATED DECOMMISSIONING
$ifi %DECOM%==yes G_STO_YCRAF(Y,C,IR,IA,IGH,FFF,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'DECOMMISSIONING','GWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND IGDECOMEXOPOT(Y,IA,IGH) AND (IGHSTO(IGH) OR IGHSTOS(IGH)) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
$ifi %DECOM%==yes -IOF0001*VDECOM_EXO_ACCUM.L(Y,IA,IGH)
;

* ------------- END OF HEAT STORAGE --------------

* ---------------- END OF ENERGY STORAGE -----------------

* ------------- END OF HEAT CAPACITY --------------

* ---------------- END OF ENERGY CAPACITY -----------------

*================HYDROGEN======================================
$ifi not %Hydrogen%==yes $goto endHydrogen2
GH2_T(Y,C,IR,IA,G,S,T)$(CCCRRR(C,IR) and RRRAAA(IR,IA))= VHYDROGEN_GH2_T.L(Y,IA,G,S,T);
$label endHydrogen2
*=============Hydrogenend===============================================================

* -------------------- ENERGY PRODUCTION ---------------------

** ELECTRICITY PRODUCTION HOURLY
PRO_YCRAGFST(Y,C,IR,IA,IGE,FFF,S,T,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'MWh')$((not IGETOH(IGE)) AND CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGE) AND IGF(IGE,FFF) AND GTECH_TYPE(IGE,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
       VGE_T.L(Y,IA,IGE,S,T);

** ELECTRICITY PRODUCTION ANNUALLY
PRO_YCRAGF(Y,C,IR,IA,IGE,FFF,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'TWh')$((not IGETOH(IGE)) AND CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGE) AND IGF(IGE,FFF) AND GTECH_TYPE(IGE,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
       SUM((S,T),IHOURSINST(S,T)*VGE_T.L(Y,IA,IGE,S,T))/IOF1000000;

* ------------------------ END OF ELECTRICITY PRODUCTION --------------

* ------------------------ HEAT PRODUCTION ---------------------
** HEAT PRODUCTION HOURLY
*** DISTRICT HEAT
PRO_YCRAGFST(Y,C,IR,IA,IGH,FFF,S,T,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY) )=
       VGH_T.L(Y,IA,IGH,S,T);

*** INDHEAT
$ifi %INDHEAT%==yes PRO_IDVH_YCRAGFST(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,S,T,INDHEAT_DHUSER,TECH_TYPE,INDHEAT_GROUP,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) and (INDHEAT_GDATA(INDHEAT_G,'GDFUEL') EQ FDATA(FFF,'FDACRONYM')) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE) AND (INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
$ifi %INDHEAT%==yes $ifi %COMBTECH%==yes     OR SUM(INDHEAT_GALIAS$INDHEAT_GGCOMB(INDHEAT_GALIAS,INDHEAT_G), INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_GALIAS,INDHEAT_GROUP))
$ifi %INDHEAT%==yes                 ))=
$ifi %INDHEAT%==yes       INDHEAT_VGH_T.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_G,INDHEAT_GROUP,S,T);

*** PROCESS HEAT
***PRO_YCRAGFST(Y,C,IR,IA,IGH,FFF,S,T,'PROCESS_HEAT',TECH_TYPE,TECH_CATEGORY,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
***       VGH_T.L(Y,IA,IGH,S,T);

** HEAT PRODUCTION ANNUAL
*** DISTRICT HEAT
PRO_YCRAGF(Y,C,IR,IA,IGH,FFF,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
       SUM((S,T),IHOURSINST(S,T)*VGH_T.L(Y,IA,IGH,S,T))/IOF1000000;

*** INDHEAT
$ifi %INDHEAT%==yes PRO_YCRAGF(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,INDHEAT_DHUSER,TECH_TYPE,INDHEAT_GROUP,'TWh')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) and (INDHEAT_GDATA(INDHEAT_G,'GDFUEL') EQ FDATA(FFF,'FDACRONYM')) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE) AND (INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
$ifi %INDHEAT%==yes $ifi %COMBTECH%==yes     OR SUM(INDHEAT_GALIAS$INDHEAT_GGCOMB(INDHEAT_GALIAS,INDHEAT_G), INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_GALIAS,INDHEAT_GROUP))
$ifi %INDHEAT%==yes            ))=
$ifi %INDHEAT%==yes       SUM((S,T),IHOURSINST(S,T)*INDHEAT_VGH_T.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_G,INDHEAT_GROUP,S,T))/IOF1000000;

*** PROCESS HEAT
***PRO_YCRAGF(Y,C,IR,IA,IGH,FFF,'PROCESS_HEAT',TECH_TYPE,TECH_CATEGORY,'TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
***       SUM((S,T),IHOURSINST(S,T)*VGH_T.L(Y,IA,IGH,S,T))/IOF1000000;


* ------------------------ END OF HEAT PRODUCTION --------------

* ---------------- END OF ENERGY PRODUCTION -----------------

* ---------------- STORAGE VOLUME -----------------
HEAT_STORAGE_VOLUME(Y,C,IR,IA,IGHSTOALL,S,T,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGHSTOALL)  AND GTECH_TYPE(IGHSTOALL,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY) )= VHSTOVOLT.L(Y,IA,IGHSTOALL,S,T)+VHSTOVOLTS.L(Y,IA,IGHSTOALL,S,T) ;
$ifi %INDHEAT%==yes HEAT_STORAGE_VOLUME(Y,C,IR,INDHEAT_IA,INDHEAT_IGHSTO,S,T,'INDIVIDUAL_HEAT',TECH_TYPE,INDHEAT_GROUP,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) and INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_IGHSTO,INDHEAT_GROUP)  AND INDHEAT_GTECH_TYPE(INDHEAT_IGHSTO,TECH_TYPE) )=   INDHEAT_VHSTOVOLT.L(Y,INDHEAT_IA,INDHEAT_IGHSTO,INDHEAT_GROUP,S,T);

WEEKLY_HYDRO_STORAGE_VOLUME(Y,C,IR,IA,S,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA))=VHYRS_S.L(Y,IA,S);
* ---------------- END OF STORAGE VOLUME -----------------

* -------------------- FUEL CONSUMPTION ---------------------
$ifi not %VGF%==Y $goto endvgfy

** ANNUAL FUEL CONSUMPTION
F_CONS_YCRA(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'POWER_DH','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
       VGF_T.L(Y,IA,G)/IOF1000000;

*** INDHEAT
$ifi not %INDHEAT%==yes $goto noindheatfuelcon
F_CONS_YCRA(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'INDIVIDUAL_HEAT','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) and (INDHEAT_GDATA(INDHEAT_G,'GDFUEL') EQ FDATA(FFF,'FDACRONYM')) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE) and (INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
$ifi %COMBTECH%==yes     OR SUM(INDHEAT_GALIAS$INDHEAT_GGCOMB(INDHEAT_GALIAS,INDHEAT_G), INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_GALIAS,INDHEAT_GROUP))
                                                                                                 ))=  INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)/IOF1000000;
$label noindheatfuelcon

*** INDUSTRY SECTOR
***F_CONS_YCRA(Y,C,IR,IA,G,FFF,TECH_TYPE,'INDUSTRY','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE) AND INDUSTRY_AREAS(IA))=
***       VGF_T.L(Y,IA,G)/IOF1000000;
***F_CONS_YCRA(Y,C,IR,IA,'GNR_EH_HEAT',FFF,TECH_TYPE,TECH_CATEGORY,'INDUSTRY','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,'GNR_EH_HEAT') AND IGF('GNR_EH_HEAT',FFF) AND GTECH_TYPE('GNR_EH_HEAT',TECH_TYPE) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
***       0;
$label endvgfy

$ifi not %VGF%==ST $goto endvgfst
** HOURLY FUEL CONSUMPTION

*** OTHER SECTOR (INCL. INDHEAT)
F_CONS_YCRAST(Y,C,IR,IA,G,FFF,S,T,TECH_TYPE,TECH_CATEGORY,'POWER_DH','MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
       VGF_T.L(Y,IA,G,S,T);
F_CONS_YCRAST(Y,C,IR,IA,'GNR_EH_HEAT',FFF,S,T,TECH_TYPE,TECH_CATEGORY,'POWER_DH','MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,'GNR_EH_HEAT') AND IGF('GNR_EH_HEAT',FFF) AND GTECH_TYPE('GNR_EH_HEAT',TECH_TYPE) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
       VGF_T.L(Y,IA,'GNR_EH_HEAT',S,T);

*** INDHEAT
F_CONS_YCRAST(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,S,T,TECH_TYPE,INDHEAT_GROUP,'INDIVIDUAL_HEAT','MWh')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) and INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) and (INDHEAT_GDATA(INDHEAT_G,'GDFUEL') EQ FDATA(FFF,'FDACRONYM')) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
       INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T);

*** INDUSTRY SECTOR
***F_CONS_YCRAST(Y,C,IR,IA,G,FFF,S,T,TECH_TYPE,'INDUSTRY','MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE) AND INDUSTRY_AREAS(IA))=
***       VGF_T.L(Y,IA,G,S,T);
***F_CONS_YCRAST(Y,C,IR,IA,'GNR_EH_HEAT',FFF,S,T,TECH_TYPE,'INDUSTRY','MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,'GNR_EH_HEAT') AND IGF('GNR_EH_HEAT',FFF) AND GTECH_TYPE('GNR_EH_HEAT',TECH_TYPE) AND INDUSTRY_AREAS(IA))=
***       0;


** ANNUAL FUEL CONSUMPTION
*** OTHER SECTOR
F_CONS_YCRA(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'POWER_DH','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE) AND NOT INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
       SUM((S,T),IHOURSINST(S,T)*VGF_T.L(Y,IA,G,S,T))/IOF1000000;
F_CONS_YCRA(Y,C,IR,IA,'GNR_EH_HEAT',FFF,TECH_TYPE,TECH_CATEGORY,'POWER_DH','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,'GNR_EH_HEAT') AND IGF('GNR_EH_HEAT',FFF) AND GTECH_TYPE('GNR_EH_HEAT',TECH_TYPE) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
       SUM((S,T),IHOURSINST(S,T)*VGF_T.L(Y,IA,'GNR_EH_HEAT',S,T))/IOF1000000;

*** INDHEAT
$ifi %INDHEAT%==yes  F_CONS_YCRA(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'INDIVIDUAL_HEAT','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) and INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) and  (INDHEAT_GDATA(INDHEAT_G,'GDFUEL') EQ FDATA(FFF,'FDACRONYM')) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
$ifi %INDHEAT%==yes        SUM((S,T),IHOURSINST(S,T)*INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T))/IOF1000000;

*** INDUSTRY SECTOR
***F_CONS_YCRA(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'INDUSTRY','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
***       SUM((S,T),IHOURSINST(S,T)*VGF_T.L(Y,IA,G,S,T))/IOF1000000;
***F_CONS_YCRA(Y,C,IR,IA,'GNR_EH_HEAT',FFF,TECH_TYPE,TECH_CATEGORY,'INDUSTRY','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,'GNR_EH_HEAT') AND IGF('GNR_EH_HEAT',FFF) AND GTECH_TYPE('GNR_EH_HEAT',TECH_TYPE) AND INDUSTRY_AREAS(IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
***       0;
$label endvgfst

**** FUEL CONSUMPTION EQUATIONS FROM STANDARD OUTPUT FILE
$ONTEXT
** HOURLY FUEL CONSUMPTION
F_CONS_YCRAST(Y,C,IR,IA,G,FFF,S,T,TECH_TYPE,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE))=
       (VGE_T.L(Y,IA,G,S,T)*IGFE_FACTOR(Y,IA,G) + VGH_T.L(Y,IA,G,S,T)*IGFH_FACTOR(Y,IA,G));

** ANNUAL FUEL CONSUMPTION
F_CONS_YCRA(Y,C,IR,IA,G,FFF,TECH_TYPE,'TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE))=
       SUM((S,T),IHOURSINST(S,T)*(VGE_T.L(Y,IA,G,S,T)*IGFE_FACTOR(Y,IA,G) + VGH_T.L(Y,IA,G,S,T)*IGFH_FACTOR(Y,IA,G)))/IOF1000000;
$OFFTEXT


* ---------------- END OF FUEL CONSUMPTION -----------------


* ---------------- ENERGY CURTAILMENT -----------------------
*HOURLY CURTAILMENT
CURT_YCRAGFST(Y,C,IR,IA,IGHYRR,FFF,S,T,'ELECTRICITY','HYDRO-RUN-OF-RIVER','MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGHYRR) AND IGF(IGHYRR,FFF) AND GTECH_TYPE(IGHYRR,'HYDRO-RUN-OF-RIVER') AND IWTRRRSUM(IA))=
(WTRRRFLH(IA) * (
           GKFX(Y,IA,IGHYRR)
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM.L(Y,IA,IGHYRR)
        +  VGKNACCUMNET.L(Y,IA,IGHYRR)
                          ) * WTRRRVAR_T(IA,S,T) * (1$(NOT IGKRATE(IA,IGHYRR,S,T)) + IGKRATE(IA,IGHYRR,S,T))) / IWTRRRSUM(IA)
-VGE_T.L(Y,IA,IGHYRR,S,T);

CURT_YCRAGFST(Y,C,IR,IA,IGWND,FFF,S,T,'ELECTRICITY',TECH_TYPE,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGWND) AND IGF(IGWND,FFF) AND GTECH_TYPE(IGWND,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,'WIND') AND IWND_SUMST(IA)
$ifi %STEPWISEKPOT%==YES       AND NOT IKPOTSTEP(IA,IGWND)
                 )=
$ifi %WNDFLH_DOL%==AAA         (WNDFLH(IA) * (
$ifi %WNDFLH_DOL%==AAA_GGG     (WNDFLH(IA,IGWND) * (
            GKFX(Y,IA,IGWND)
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM.L(Y,IA,IGWND)
         + VGKNACCUMNET.L(Y,IA,IGWND)
                 )  * WND_VAR_T(IA,S,T) * (1$(NOT IGKRATE(IA,IGWND,S,T)) + IGKRATE(IA,IGWND,S,T))) / IWND_SUMST(IA)
-VGE_T.L(Y,IA,IGWND,S,T);


CURT_YCRAGFST(Y,C,IR,IA,IGSOLE,FFF,S,T,'ELECTRICITY',TECH_TYPE,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGSOLE) AND IGF(IGSOLE,FFF) AND GTECH_TYPE(IGSOLE,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,'SOLAR-PV') AND ISOLESUMST(IA)
$ifi %STEPWISEKPOT%==YES       AND NOT IKPOTSTEP(IA,IGSOLE)
                 )=
$ifi %SOLEFLH_DOL%==AAA         (SOLEFLH(IA) * (
$ifi %SOLEFLH_DOL%==AAA_GGG     (SOLEFLH(IA,IGSOLE) * (
            GKFX(Y,IA,IGSOLE)
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM.L(Y,IA,IGSOLE)
         + VGKNACCUMNET.L(Y,IA,IGSOLE)
                 )  * SOLE_VAR_T(IA,S,T) * (1$(NOT IGKRATE(IA,IGSOLE,S,T)) + IGKRATE(IA,IGSOLE,S,T))) / ISOLESUMST(IA)
-VGE_T.L(Y,IA,IGSOLE,S,T);

$ifi NOT %STEPWISEKPOT%==YES $goto endstepwisekpot
CURT_YCRAGFST(Y,C,IR,IA,IGWND,FFF,S,T,'ELECTRICITY',TECH_TYPE,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGWND) AND IGF(IGWND,FFF) AND GTECH_TYPE(IGWND,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,'WIND') AND IWND_SUMST(IA)
              AND IKPOTSTEP(IA,IGWND)
                 )=
$ifi %WNDFLH_DOL%==AAA         (WNDFLH(IA) * (
$ifi %WNDFLH_DOL%==AAA_GGG     (WNDFLH(IA,IGWND) * (
                               SUM(KPOTSTEP,(IGKFX_KPOTSTEP(Y,IA,IGWND,KPOTSTEP) + VGKNACCUMNET_KPOTSTEP.L(Y,IA,IGWND,KPOTSTEP)) *IKPOTSTEP_FLHA(IA,IGWND,KPOTSTEP))
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM.L(Y,IA,IGWND)
                 )  * WND_VAR_T(IA,S,T) * (1$(NOT IGKRATE(IA,IGWND,S,T)) + IGKRATE(IA,IGWND,S,T))) / IWND_SUMST(IA)
-VGE_T.L(Y,IA,IGWND,S,T);

CURT_YCRAGFST(Y,C,IR,IA,IGSOLE,FFF,S,T,'ELECTRICITY',TECH_TYPE,'MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGSOLE) AND IGF(IGSOLE,FFF) AND GTECH_TYPE(IGSOLE,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,'SOLAR-PV') AND ISOLESUMST(IA)
              AND IKPOTSTEP(IA,IGSOLE)
                 )=
$ifi %SOLEFLH_DOL%==AAA         (SOLEFLH(IA) * (
$ifi %SOLEFLH_DOL%==AAA_GGG     (SOLEFLH(IA,IGSOLE) * (
                               SUM(KPOTSTEP,(IGKFX_KPOTSTEP(Y,IA,IGSOLE,KPOTSTEP) + VGKNACCUMNET_KPOTSTEP.L(Y,IA,IGSOLE,KPOTSTEP)) *IKPOTSTEP_FLHA(IA,IGSOLE,KPOTSTEP))
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM.L(Y,IA,IGSOLE)
                 )  * SOLE_VAR_T(IA,S,T) * (1$(NOT IGKRATE(IA,IGSOLE,S,T)) + IGKRATE(IA,IGSOLE,S,T))) / ISOLESUMST(IA)
-VGE_T.L(Y,IA,IGSOLE,S,T);
$label endstepwisekpot

CURT_YCRAGFST(Y,C,IR,IA,IGSOLH,FFF,S,T,'DISTRICT_HEAT','SOLAR-HEATING','MWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGSOLH) AND IGF(IGSOLH,FFF) AND GTECH_TYPE(IGSOLH,'SOLAR-HEATING') AND ISOLHSUMST(IA))=
$ifi %SOLHFLH_DOL%==AAA         (SOLHFLH(IA) * (
$ifi %SOLHFLH_DOL%==AAA_GGG     (SOLHFLH(IA,IGSOLH) * (
            GKFX(Y,IA,IGSOLH)
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM.L(Y,IA,IGSOLH)
         + VGKNACCUMNET.L(Y,IA,IGSOLH)
                 )  * SOLH_VAR_T(IA,S,T) * (1$(NOT IGKRATE(IA,IGSOLH,S,T)) + IGKRATE(IA,IGSOLH,S,T))) / ISOLHSUMST(IA)
-VGE_T.L(Y,IA,IGSOLH,S,T);

CURT_YCRAGFST(Y,C,IR,IA,G,FFF,S,T,COMMODITY,TECH_TYPE,UNITS)$(ABS(CURT_YCRAGFST(Y,C,IR,IA,G,FFF,S,T,COMMODITY,TECH_TYPE,UNITS)) LT 0.000001)  =0;

*ANNUAL CURTAILMENT
CURT_YCRAGF(Y,C,IR,IA,IGHYRR,FFF,'ELECTRICITY','HYDRO-RUN-OF-RIVER','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGHYRR) AND IGF(IGHYRR,FFF) AND GTECH_TYPE(IGHYRR,'HYDRO-RUN-OF-RIVER'))=
SUM((S,T),IHOURSINST(S,T)*CURT_YCRAGFST(Y,C,IR,IA,IGHYRR,FFF,S,T,'ELECTRICITY','HYDRO-RUN-OF-RIVER','MWh'))/IOF1000000
;
CURT_YCRAGF(Y,C,IR,IA,IGWND,FFF,'ELECTRICITY',TECH_TYPE,'TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGWND) AND IGF(IGWND,FFF) AND TECH_TYPE_CATEGORY(TECH_TYPE,'WIND') AND GTECH_TYPE(IGWND,TECH_TYPE))=
SUM((S,T),IHOURSINST(S,T)*CURT_YCRAGFST(Y,C,IR,IA,IGWND,FFF,S,T,'ELECTRICITY',TECH_TYPE,'MWh'))/IOF1000000
;
CURT_YCRAGF(Y,C,IR,IA,IGSOLE,FFF,'ELECTRICITY',TECH_TYPE,'TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGSOLE) AND IGF(IGSOLE,FFF) AND TECH_TYPE_CATEGORY(TECH_TYPE,'SOLAR-PV') AND GTECH_TYPE(IGSOLE,TECH_TYPE))=
SUM((S,T),IHOURSINST(S,T)*CURT_YCRAGFST(Y,C,IR,IA,IGSOLE,FFF,S,T,'ELECTRICITY',TECH_TYPE,'MWh'))/IOF1000000
;
CURT_YCRAGF(Y,C,IR,IA,IGSOLH,FFF,'DISTRICT_HEAT','SOLAR-HEATING','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGSOLH) AND IGF(IGSOLH,FFF) AND GTECH_TYPE(IGSOLH,'SOLAR-HEATING'))=
SUM((S,T),IHOURSINST(S,T)*CURT_YCRAGFST(Y,C,IR,IA,IGSOLH,FFF,S,T,'DISTRICT_HEAT','SOLAR-HEATING','MWh'))/IOF1000000
;

*Curtailment of hydro reservoirs should be analyzed by aggregating the technology set
CURT_YCRAGF(Y,C,IR,IA,IGHYRS,FFF,'ELECTRICITY','HYDRO-RESERVOIRS','TWh')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGHYRS) AND IGF(IGHYRS,FFF) AND GTECH_TYPE(IGHYRS,'HYDRO-RESERVOIRS'))=
SUM(S,
        IHYINF_S(IA,S) *
        (
        GKFX(Y,IA,IGHYRS)
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM.L(Y,IA,IGHYRS)
       +VGKNACCUMNET.L(Y,IA,IGHYRS)
         )
         -SUM(T,IHYRST(S,T)*VGE_T.L(Y,IA,IGHYRS,S,T))
    )/IOF1000000
;


* ---------------- END OF ENERGY CURTAILMENT -----------------------

* ------------------------- ENERGY DEMAND ----------------------

* ------------- ELECTRICITY DEMAND --------------

*HOURLY
** EXOGENOUS DEMAND

EL_DEMAND_YCRST(Y,C,IR,S,T,'EXOGENOUS',SECTOR,'MWh')$CCCRRR(C,IR)=
         SUM(DEUSER,DEUSERINSECTOR(DEUSER,SECTOR)*IDE_T(Y,IR,DEUSER,S,T))/(1-DISLOSS_E(IR));
*EL_DEMAND_YCRST(Y,C,IR,S,T,'EXOGENOUS','EV','MWh')$CCCRRR(C,IR) =         SUM(DEUSER,IDE_T(Y,IR,'EV',S,T))/(1-DISLOSS_E(IR)) ;
*EL_DEMAND_YCRST(Y,C,IR,S,T,'EXOGENOUS','P2X','MWh')$CCCRRR(C,IR) =         SUM(DEUSER,IDE_T(Y,IR,'PTX',S,T))/(1-DISLOSS_E(IR)) ;

EL_NET_DEMAND_YCRST(Y,C,IR,S,T,DEUSER,'MWh')$CCCRRR(C,IR)=
VDENET_T.L(Y,IR,DEUSER,S,T);

** ENDOGENOUS DEMAND

EL_DEMAND_YCRST(Y,C,IR,S,T,'ENDOGENOUS','DISTRICT_HEAT','MWh')$CCCRRR(C,IR)=
* HEAT PUMPS CONSUMPTION
           SUM(IA$(RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA)), SUM(IGETOH$IAGK_HASORPOT(Y,IA,IGETOH), VGE_T.L(Y,IA,IGETOH,S,T)))
;

EL_DEMAND_YCRST(Y,C,IR,S,T,'ENDOGENOUS','POWER_DH','MWh')$CCCRRR(C,IR)=
* INTRASEASONAL ELECTRICITY STORAGE
         +SUM(IA$(RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA)),SUM(IGESTO$IAGK_HASORPOT(Y,IA,IGESTO),VESTOLOADT.L(Y,IA,IGESTO,S,T)))
;

EL_DEMAND_YCRST(Y,C,IR,S,T,'ENDOGENOUS','POWER_DH','MWh')$CCCRRR(C,IR)=
* INTERSEASONAL ELECTRICITY STORAGE
         +SUM(IA$(RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA)),SUM(IGESTOS$IAGK_HASORPOT(Y,IA,IGESTOS),VESTOLOADTS.L(Y,IA,IGESTOS,S,T)))
;

$ifi not %EV%==yes   $goto noeveldemandST
EL_DEMAND_YCRST(Y,C,IR,S,T,'ENDOGENOUS','EV_CHARGING','TWh')$CCCRRR(C,IR)=
$ifi not %EV2%==yes          (VEV_VNETCHARGE_BEV.L(Y,IR,S,T) + VEV_VNETCHARGE_PHEV.L(Y,IR,S,T))
$ifi %EV2%==yes              (VEV_VG2V_BEV.L(Y,IR,S,T) + VEV_VG2V_PHEV.L(Y,IR,S,T))
          /IOF1000000;
EL_DEMAND_YCRST(Y,C,IR,S,T,'ENDOGENOUS','EV_DISCHARGING','TWh')$CCCRRR(C,IR)=
$ifi not %EV2%==yes          ( - VEV_VNETDISCHARGE_BEV.L(Y,IR,S,T) - VEV_VNETDISCHARGE_PHEV.L(Y,IR,S,T))
$ifi %EV2%==yes              ( - VEV_VV2G_BEV.L(Y,IR,S,T) - VEV_VV2G_PHEV.L(Y,IR,S,T))
          /IOF1000000;
$label noeveldemandST

*** IND_HEAT SECTOR
$ifi %INDHEAT%==yes EL_DEMAND_YCRST(Y,C,IR,S,T,'ENDOGENOUS','INDIVIDUAL_HEAT','MWh')$CCCRRR(C,IR)=
* HEAT PUMPS AND ELECTRIC HEATERS CONSUMPTION
$ifi %INDHEAT%==yes SUM(INDHEAT_IA$RRRAAA(IR,INDHEAT_IA), SUM((INDHEAT_DHUSER,INDHEAT_G,INDHEAT_GROUP)$(INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_IGETOH(INDHEAT_G) AND INDHEAT_GINGROUP(INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTODHUSER(INDHEAT_G,INDHEAT_DHUSER)),
$ifi %INDHEAT%==yes      INDHEAT_VGH_T.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_G,INDHEAT_GROUP,S,T)/(INDHEAT_GDATA(INDHEAT_G,'GDFE')$(INDHEAT_IGETOH_NOTHP(INDHEAT_G))+INDHEAT_COP(INDHEAT_IA,INDHEAT_G,S,T)$(INDHEAT_IGHP(INDHEAT_G)))));


*** INDUSTRY SECTOR
***EL_DEMAND_YCRST(Y,C,IR,S,T,'ENDOGENOUS','HP_IND','MWh')$CCCRRR(C,IR)=
* HEAT PUMPS CONSUMPTION
***        SUM(IA$(RRRAAA(IR,IA) AND INDUSTRY_AREAS(IA)), SUM(IGETOH$IAGK_HASORPOT(Y,IA,IGETOH), VGE_T.L(Y,IA,IGETOH,S,T)));


*ANNUAL DEMAND
*summed to yearly values
** EXOGENOUS DEMAND

EL_DEMAND_YCR(Y,C,IR,'EXOGENOUS',SECTOR,'TWh')$CCCRRR(C,IR)=
         SUM((S,T,DEUSER),IHOURSINST(S,T)*IDE_T(Y,IR,DEUSER,S,T)*DEUSERINSECTOR(DEUSER,SECTOR))/(1-DISLOSS_E(IR)) /IOF1000000 ;
*EL_DEMAND_YCR(Y,C,IR,'EXOGENOUS','EV','TWh')$CCCRRR(C,IR) =         SUM((S,T,DEUSER),IHOURSINST(S,T)*IDE_T(Y,IR,'EV',S,T))/(1-DISLOSS_E(IR))/IOF1000000 ;
*EL_DEMAND_YCR(Y,C,IR,'EXOGENOUS','P2X','TWh')$CCCRRR(C,IR) =         SUM((S,T,DEUSER),IHOURSINST(S,T)*IDE_T(Y,IR,'PTX',S,T))/(1-DISLOSS_E(IR))/IOF1000000 ;

** ENDOGENOUS DEMAND

EL_DEMAND_YCR(Y,C,IR,'ENDOGENOUS','DISTRICT_HEAT','TWh')$CCCRRR(C,IR)=
* HEAT PUMPS CONSUMPTION
           SUM((S,T,IA)$(RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA)), SUM(IGETOH$(IAGK_HASORPOT(Y,IA,IGETOH) AND GDATA(IGETOH,'GDTECHGROUP') EQ HEATPUMP), IHOURSINST(S,T)*VGE_T.L(Y,IA,IGETOH,S,T)))/IOF1000000
* EL BOILERS CONSUMPTION
         + SUM((S,T,IA)$(RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA)), SUM(IGETOH$(IAGK_HASORPOT(Y,IA,IGETOH) AND GDATA(IGETOH,'GDTECHGROUP') EQ BOILER), IHOURSINST(S,T)*VGE_T.L(Y,IA,IGETOH,S,T)))/IOF1000000
;

EL_DEMAND_YCR(Y,C,IR,'ENDOGENOUS','STORAGE_LOSS_ST','TWh')$CCCRRR(C,IR)=
* INTRASEASONAL ELECTRICITY STORAGE LOSS
         +SUM((S,T,IA)$(RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA)),SUM(IGESTO$IAGK_HASORPOT(Y,IA,IGESTO),IHOURSINST(S,T)*(VESTOLOADT.L(Y,IA,IGESTO,S,T)-VGE_T.L(Y,IA,IGESTO,S,T))))/IOF1000000
;

EL_DEMAND_YCR(Y,C,IR,'ENDOGENOUS','STORAGE_LOSS_LT','TWh')$CCCRRR(C,IR)=
* INTERSEASONAL ELECTRICITY STORAGE LOSS
         +SUM((S,T,IA)$(RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA)),SUM(IGESTOS$IAGK_HASORPOT(Y,IA,IGESTOS),IHOURSINST(S,T)*(VESTOLOADTS.L(Y,IA,IGESTOS,S,T)-VGE_T.L(Y,IA,IGESTOS,S,T))))/IOF1000000
;

$ifi not %EV%==yes   $goto noeveldemand
EL_DEMAND_YCR(Y,C,IR,'ENDOGENOUS','EV_CHARGING','TWh')$CCCRRR(C,IR)=
         SUM((S,T),IHOURSINST(S,T)*
$ifi not %EV2%==yes          (VEV_VNETCHARGE_BEV.L(Y,IR,S,T) + VEV_VNETCHARGE_PHEV.L(Y,IR,S,T))
$ifi %EV2%==yes              (VEV_VG2V_BEV.L(Y,IR,S,T) + VEV_VG2V_PHEV.L(Y,IR,S,T))
          )/IOF1000000;
EL_DEMAND_YCR(Y,C,IR,'ENDOGENOUS','EV_DISCHARGING','TWh')$CCCRRR(C,IR)=
         SUM((S,T),IHOURSINST(S,T)*
$ifi not %EV2%==yes          ( - VEV_VNETDISCHARGE_BEV.L(Y,IR,S,T) - VEV_VNETDISCHARGE_PHEV.L(Y,IR,S,T))
$ifi %EV2%==yes              ( - VEV_VV2G_BEV.L(Y,IR,S,T) - VEV_VV2G_PHEV.L(Y,IR,S,T))
          )/IOF1000000;
$label noeveldemand

*** IND_HEAT SECTOR
$ifi %INDHEAT%==yes EL_DEMAND_YCR(Y,C,IR,'ENDOGENOUS','INDIVIDUAL_HEAT','TWh')$CCCRRR(C,IR)=
* HEAT PUMPS AND ELECTRIC HEATERS CONSUMPTION
$ifi %INDHEAT%==yes SUM(INDHEAT_IA$RRRAAA(IR,INDHEAT_IA), SUM((INDHEAT_DHUSER,INDHEAT_G,INDHEAT_GROUP,S,T)$(INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_IGETOH(INDHEAT_G) AND INDHEAT_GINGROUP(INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTODHUSER(INDHEAT_G,INDHEAT_DHUSER)),
$ifi %INDHEAT%==yes      IHOURSINST(S,T)*INDHEAT_VGH_T.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_G,INDHEAT_GROUP,S,T)/(INDHEAT_GDATA(INDHEAT_G,'GDFE')$(INDHEAT_IGETOH_NOTHP(INDHEAT_G))+INDHEAT_COP(INDHEAT_IA,INDHEAT_G,S,T)$(INDHEAT_IGHP(INDHEAT_G)))))/IOF1000000;


*** INDUSTRY SECTOR
***EL_DEMAND_YCR(Y,C,IR,'ENDOGENOUS','HP_IND','TWh')$CCCRRR(C,IR)=
* HEAT PUMPS CONSUMPTION
***        SUM((S,T),SUM(IA$(RRRAAA(IR,IA) AND INDUSTRY_AREAS(IA)), SUM(IGETOH$IAGK_HASORPOT(Y,IA,IGETOH), VGE_T.L(Y,IA,IGETOH,S,T))))/IOF1000000;


* ----------- END OF ELECTRICITY DEMAND --------------

* ------------- HEAT DEMAND --------------
*HOURLY DEMAND
** EXOGENOUS DEMAND

H_DEMAND_YCRAST(Y,C,IR,IA,'DISTRICT_HEAT',S,T,'EXOGENOUS','RES','MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA))=
         IDH_T(Y,IA,'RESH',S,T)/(1-DISLOSS_H(IA));

*** INDHEAT SECTOR
$ifi %INDHEAT%==yes H_DEMAND_YCRAST(Y,C,IR,INDHEAT_IA,'SPACEHEAT',S,T,'EXOGENOUS',SECTOR,'MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND INDHEAT_AAAINSECTOR(INDHEAT_IA,SECTOR))=
$ifi %INDHEAT%==yes           (INDHEAT_DH(Y,INDHEAT_IA,'SPACEHEAT') * INDHEAT_DH_VAR_T(INDHEAT_IA,'SPACEHEAT',S,T)) / (INDHEAT_IDH_SUMST(INDHEAT_IA,'SPACEHEAT')$(INDHEAT_IDH_SUMST(INDHEAT_IA,'SPACEHEAT') GT 0)+1$(INDHEAT_IDH_SUMST(INDHEAT_IA,'SPACEHEAT') EQ 0)) ;
$ifi %INDHEAT%==yes H_DEMAND_YCRAST(Y,C,IR,INDHEAT_IA,'HOTWATER',S,T,'EXOGENOUS',SECTOR,'MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND INDHEAT_AAAINSECTOR(INDHEAT_IA,SECTOR))=
$ifi %INDHEAT%==yes           (INDHEAT_DH(Y,INDHEAT_IA,'HOTWATER') * INDHEAT_DH_VAR_T(INDHEAT_IA,'HOTWATER',S,T)) / (INDHEAT_IDH_SUMST(INDHEAT_IA,'HOTWATER')$(INDHEAT_IDH_SUMST(INDHEAT_IA,'HOTWATER') GT 0)+1$(INDHEAT_IDH_SUMST(INDHEAT_IA,'HOTWATER') EQ 0)) ;

*** INDUSTRY SECTOR
***H_DEMAND_YCRAST(Y,C,IR,IA,S,T,'PROCESS_HEAT','EXOGENOUS','MWh','INDUSTRY')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND INDUSTRY_AREAS(IA))=
***         SUM(DHUSER,IDH_T(Y,IA,DHUSER,S,T))/(1-DISLOSS_H(IA));

** ENDOGENOUS DEMAND
H_DEMAND_YCRAST(Y,C,IR,IA,'DISTRICT_HEAT',S,T,'ENDOGENOUS','RES','MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA))=
* INTRASEASONAL HEAT STORAGE
        SUM(IGHSTO$IAGK_HASORPOT(Y,IA,IGHSTO),VHSTOLOADT.L(Y,IA,IGHSTO,S,T))
* INTERSEASONAL HEAT STORAGE
        + SUM(IGHSTOS$IAGK_HASORPOT(Y,IA,IGHSTOS),VHSTOLOADTS.L(Y,IA,IGHSTOS,S,T));

*** INDHEAT SECTOR
$ifi %INDHEAT%==yes H_DEMAND_YCRAST(Y,C,IR,INDHEAT_IA,'SPACEHEAT',S,T,'ENDOGENOUS',SECTOR,'MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND INDHEAT_AAAINSECTOR(INDHEAT_IA,SECTOR))=
* INTRASEASONAL HEAT STORAGE
$ifi %INDHEAT%==yes         SUM((INDHEAT_IGHSTO,INDHEAT_GROUP)$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_IGHSTO,INDHEAT_GROUP),INDHEAT_VHSTOLOADT.L(Y,INDHEAT_IA,'SPACEHEAT',INDHEAT_IGHSTO,INDHEAT_GROUP,S,T));
*** INDHEAT SECTOR
$ifi %INDHEAT%==yes H_DEMAND_YCRAST(Y,C,IR,INDHEAT_IA,'HOTWATER',S,T,'ENDOGENOUS',SECTOR,'MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND INDHEAT_AAAINSECTOR(INDHEAT_IA,SECTOR))=
* INTRASEASONAL HEAT STORAGE
$ifi %INDHEAT%==yes         SUM((INDHEAT_IGHSTO,INDHEAT_GROUP)$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_IGHSTO,INDHEAT_GROUP),INDHEAT_VHSTOLOADT.L(Y,INDHEAT_IA,'HOTWATER',INDHEAT_IGHSTO,INDHEAT_GROUP,S,T));

*summed yearly values
** EXOGENOUS DEMAND

H_DEMAND_YCRA(Y,C,IR,IA,'DISTRICT_HEAT','EXOGENOUS','RES','TWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA))=
         SUM((S,T),IHOURSINST(S,T)*IDH_T(Y,IA,'RESH',S,T))/(1-DISLOSS_H(IA))/IOF1000000;


*** INDHEAT SECTOR
$ifi %INDHEAT%==yes H_DEMAND_YCRA(Y,C,IR,INDHEAT_IA,'SPACEHEAT','EXOGENOUS',SECTOR,'TWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND INDHEAT_AAAINSECTOR(INDHEAT_IA,SECTOR))=
$ifi %INDHEAT%==yes         SUM((S,T),(IHOURSINST(S,T)*INDHEAT_DH(Y,INDHEAT_IA,'SPACEHEAT') * INDHEAT_DH_VAR_T(INDHEAT_IA,'SPACEHEAT',S,T)) / (INDHEAT_IDH_SUMST(INDHEAT_IA,'SPACEHEAT')$(INDHEAT_IDH_SUMST(INDHEAT_IA,'SPACEHEAT') GT 0)+1$(INDHEAT_IDH_SUMST(INDHEAT_IA,'SPACEHEAT') EQ 0)))/IOF1000000 ;
$ifi %INDHEAT%==yes H_DEMAND_YCRA(Y,C,IR,INDHEAT_IA,'HOTWATER','EXOGENOUS',SECTOR,'TWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND INDHEAT_AAAINSECTOR(INDHEAT_IA,SECTOR))=
$ifi %INDHEAT%==yes         SUM((S,T),(IHOURSINST(S,T)*INDHEAT_DH(Y,INDHEAT_IA,'HOTWATER') * INDHEAT_DH_VAR_T(INDHEAT_IA,'HOTWATER',S,T)) / (INDHEAT_IDH_SUMST(INDHEAT_IA,'HOTWATER')$(INDHEAT_IDH_SUMST(INDHEAT_IA,'HOTWATER') GT 0)+1$(INDHEAT_IDH_SUMST(INDHEAT_IA,'HOTWATER') EQ 0)))/IOF1000000 ;

*** INDUSTRY SECTOR
***H_DEMAND_YCRA(Y,C,IR,IA,'PROCESS_HEAT','EXOGENOUS','INDUSTRY','TWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND INDUSTRY_AREAS(IA))=
***         SUM((S,T,DHUSER),IHOURSINST(S,T)*IDH_T(Y,IA,DHUSER,S,T))/(1-DISLOSS_H(IA))/IOF1000000;

** ENDOGENOUS DEMAND
*** OTHER SECTOR
H_DEMAND_YCRA(Y,C,IR,IA,'DISTRICT_HEAT','ENDOGENOUS','STORAGE_LOSS_ST','TWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA))=
* INTRASEASONAL HEAT STORAGE LOSS
        SUM((S,T,IGHSTO)$IAGK_HASORPOT(Y,IA,IGHSTO),IHOURSINST(S,T)*(VHSTOLOADT.L(Y,IA,IGHSTO,S,T)-VGH_T.L(Y,IA,IGHSTO,S,T)))/IOF1000000;

H_DEMAND_YCRA(Y,C,IR,IA,'DISTRICT_HEAT','ENDOGENOUS','STORAGE_LOSS_LT','TWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND NOT INDUSTRY_AREAS(IA))=
* INTERSEASONAL HEAT STORAGE LOSS
        SUM((S,T,IGHSTOS)$IAGK_HASORPOT(Y,IA,IGHSTOS),IHOURSINST(S,T)*(VHSTOLOADTS.L(Y,IA,IGHSTOS,S,T)-VGH_T.L(Y,IA,IGHSTOS,S,T)))/IOF1000000;

*** INDHEAT SECTOR
$ifi %INDHEAT%==yes H_DEMAND_YCRA(Y,C,IR,INDHEAT_IA,'INDIVIDUAL_HEAT','ENDOGENOUS','STORAGE_LOSS_ST','TWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA))=
* INTRASEASONAL HEAT STORAGE LOSS
$ifi %INDHEAT%==yes         SUM((INDHEAT_DHUSER,INDHEAT_IGHSTO,INDHEAT_GROUP,S,T)$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_IGHSTO,INDHEAT_GROUP),IHOURSINST(S,T)*(INDHEAT_VHSTOLOADT.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_IGHSTO,INDHEAT_GROUP,S,T)- INDHEAT_VGH_T.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_IGHSTO,INDHEAT_GROUP,S,T)))/IOF1000000;

* ----------- END OF HEAT DEMAND --------------

* -------------------- END OF ENERGY DEMAND -----------------------


* -------------------- TRANSMISSION CAPACITY -----------------------

** EXOGENOUS ELECTRICITY CAPACITY

X_CAP_YCR(Y,C,IR,IRI,'EXOGENOUS','GW')$(CCCRRR(C,IR) AND IXK_HASORPOT(Y,IR,IRI))=  IOF0001*XKFX(Y,IR,IRI);
$ifi %FBEU%==yes  X_CAP_YCR(Y,C,IR,IRI,'EXOGENOUS_AC','GW')$(CCCRRR(C,IR) AND SUM(ACNETWORKS, IXK_AC(ACNETWORKS,IR,IRI)))=  IOF0001*XKFX('2016',IR,IRI);




** ENDOGENOUS ELECTRIC CAPACITY

$ifi not %TransInvest%==yes $goto Transmission_investments_end
X_CAP_YCR(Y,C,IR,IRI,'ENDOGENOUS','GW')$(CCCRRR(C,IR) AND IXK_HASORPOT(Y,IR,IRI))=
IOF0001*VXKNACCUMNET.L(Y,IR,IRI)
;
$label  Transmission_investments_end


* -------------------- END OF TRANSMISSION CAPACITY -----------------------

* -------------------- TRANSMISSION FLOW -----------------------

** HOURLY TRANSMISSION FLOW

X_FLOW_YCRST(Y,C,IR,IRI,S,T,'MWh')$(CCCRRR(C,IR))=
VX_T.L(Y,IR,IRI,S,T)$IXK_HASORPOT(Y,IR,IRI)
$ifi %FBEU%==yes   + VX_AC_T.L(Y,IR,IRI,S,T)$SUM(ACNETWORKS,IXK_AC(ACNETWORKS,IR,IRI))
;


** ANNUAL TRANSMISSION FLOW
X_FLOW_YCR(Y,C,IR,IRI,'TWh')=
SUM((S,T),IHOURSINST(S,T)*X_FLOW_YCRST(Y,C,IR,IRI,S,T,'MWh'))/IOF1000000;
;



* -------------------- END OF TRANSMISSION FLOW -----------------------

$ifi NOT %HEATTRANS%==yes $goto no_heattrans
* -------------------- HEAT TRANSMISSION CAPACITY -----------------------

** EXOGENOUS HEAT TRANSMISSION CAPACITY

XH_CAP_YCA(Y,C,IA,IAI,'EXOGENOUS','GW')$(ICA(C,IA) AND IXHK_HASORPOT(Y,IA,IAI))=
IOF0001*XHKFX(Y,IA,IAI)
;


** ENDOGENOUS HEAT TRANSMISSION CAPACITY

$ifi not %HeatTransInvest%==yes $goto Heat_Transmission_investments_end
XH_CAP_YCA(Y,C,IA,IAI,'ENDOGENOUS','GW')$(ICA(C,IA) AND IXHK_HASORPOT(Y,IA,IAI))=
IOF0001*VXHKNACCUMNET.L(Y,IA,IAI)
;
$label  Heat_Transmission_investments_end


* -------------------- END OF HEAT TRANSMISSION CAPACITY -----------------------

* -------------------- HEAT TRANSMISSION FLOW -----------------------

** HOURLY HEAT TRANSMISSION FLOW

XH_FLOW_YCAST(Y,C,IA,IAI,S,T,'MWh')$(ICA(C,IA) AND IXHK_HASORPOT(Y,IA,IAI))=
VXH_T.L(Y,IA,IAI,S,T);
;

** ANNUAL HEAT TRANSMISSION FLOW
XH_FLOW_YCA(Y,C,IA,IAI,'TWh')$(ICA(C,IA) AND IXHK_HASORPOT(Y,IA,IAI))=
SUM((S,T),IHOURSINST(S,T)*VXH_T.L(Y,IA,IAI,S,T))/IOF1000000;
;

* -------------------- END OF HEAT TRANSMISSION FLOW -----------------------
$label no_heattrans

* ---------------------- ECONOMIC OUTPUT ----------------------

* ------------- COMMODITY PRICES --------------

** ELECTRICITY PRICES

*HOURLY ELECTRICITY PRICE

EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh')$CCCRRR(C,IR)=OMONEY*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y);

*AVERAGE ELECTRICITY PRICE

EL_PRICE_YCR(Y,C,IR,'AVERAGE','Money_per_MWh')$CCCRRR(C,IR)=
SUM((S,T),EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh')/(IWEIGHSUMS*IWEIGHSUMT/(WEIGHT_S(S)*WEIGHT_T(T))));

$ontext
*EXCLUDED SO FAR
*AVERAGE ELECTRICITY PRICE WEIGTHED BY CONSUMPTION

EL_PRICE_YCR(Y,C,IR,'AVERAGE_WEIGHTED_BY_CONSUMPTION','Money_per_MWh')$CCCRRR(C,IR)=
               SUM((VARIABLE_CATEGORY,S,T),
                         EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh')*EL_DEMAND_YCRST(Y,C,IR,S,T,VARIABLE_CATEGORY,'MWh')
                         )
               /SUM((VARIABLE_CATEGORY,S,T),EL_DEMAND_YCRST(Y,C,IR,S,T,VARIABLE_CATEGORY,'MWh'))
;

*AVERAGE ELECTRICITY PRICE WEIGTHED BY PRODUCTION

EL_PRICE_YCR(Y,C,IR,'AVERAGE_WEIGHTED_BY_PRODUCTION','Money_per_MWh')$CCCRRR(C,IR)=
               SUM((IGE,IA,FFF,S,T,TECH_TYPE)$(RRRAAA(IR,IA) AND IAGK_HASORPOT(Y,IA,IGE)),
                         EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh')*PRO_YCRAGFST(Y,C,IR,IA,IGE,FFF,S,T,'ELECTRICITY',TECH_TYPE,'MWh')
                         )
               /SUM((IGE,IA,FFF,S,T,TECH_TYPE)$(RRRAAA(IR,IA) AND IAGK_HASORPOT(Y,IA,IGE)),PRO_YCRAGFST(Y,C,IR,IA,IGE,FFF,S,T,'ELECTRICITY',TECH_TYPE,'MWh'))
;
$offtext

** END OF ELECTRICITY PRICES

** DISTRICT HEATING PRICES

*HOURLY DISTRICT HEATING PRICE

DH_PRICE_YCRAST(Y,C,IR,IA,S,T,'Money_per_MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND SUM(DHUSER, IDH_SUMST(IA,DHUSER)))=OMONEY*QHEQ.M(Y,IA,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y);

*AVERAGE DISTRICT HEATING PRICE

DH_PRICE_YCRA(Y,C,IR,IA,'AVERAGE','Money_per_MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND SUM(DHUSER, IDH_SUMST(IA,DHUSER)))=
SUM((S,T),DH_PRICE_YCRAST(Y,C,IR,IA,S,T,'Money_per_MWh')/(IWEIGHSUMS*IWEIGHSUMT/(WEIGHT_S(S)*WEIGHT_T(T))));

$ontext
*EXCLUDED SO FAR
*AVERAGE DISTRICT HEATING PRICE WEIGTHED BY CONSUMPTION

DH_PRICE_YCRA(Y,C,IR,IA,'AVERAGE_WEIGHTED_BY_CONSUMPTION','Money_per_MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND SUM(DHUSER, IDH_SUMST(IA,DHUSER)))=
               SUM((VARIABLE_CATEGORY,S,T),
                         DH_PRICE_YCRAST(Y,C,IR,IA,S,T,'Money_per_MWh')*DH_DEMAND_YCRAST(Y,C,IR,IA,S,T,VARIABLE_CATEGORY,'MWh')
                         )
               /SUM((VARIABLE_CATEGORY,S,T),DH_DEMAND_YCRAST(Y,C,IR,IA,S,T,VARIABLE_CATEGORY,'MWh'))
;

*AVERAGE DISTRICT HEATING PRICE WEIGTHED BY PRODUCTION

DH_PRICE_YCRA(Y,C,IR,IA,'AVERAGE_WEIGHTED_BY_PRODUCTION','Money_per_MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,IA) AND SUM(DHUSER, IDH_SUMST(IA,DHUSER)))=
               SUM((IGH,FFF,S,T,TECH_TYPE)$IAGK_HASORPOT(Y,IA,IGH),
                         DH_PRICE_YCRAST(Y,C,IR,IA,S,T,'Money_per_MWh')*PRO_YCRAGFST(Y,C,IR,IA,IGH,FFF,S,T,'DISTRICT_HEAT',TECH_TYPE,'MWh')
                         )
               /SUM((IGH,FFF,S,T,TECH_TYPE)$IAGK_HASORPOT(Y,IA,IGH),PRO_YCRAGFST(Y,C,IR,IA,IGH,FFF,S,T,'DISTRICT_HEAT',TECH_TYPE,'MWh'))
;
$offtext

** END OF DISTRICT HEATING PRICES

$ifi not %INDHEAT%==yes $goto noindividualheat
*HOURLY INDIVIDUAL HEATING PRICE
IDVH_PRICE_YCRAST(Y,C,IR,INDHEAT_IA,S,T,'Money_per_MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND SUM(INDHEAT_DHUSER, INDHEAT_IDH_SUMST(INDHEAT_IA,INDHEAT_DHUSER)))=OMONEY*SUM((INDHEAT_DHUSER,INDHEAT_GROUP),INDHEAT_QHEQDHUSER.M(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_GROUP,S,T))
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y);

*AVERAGE INDIVIDUAL HEATING PRICE

IDVH_PRICE_YCRA(Y,C,IR,INDHEAT_IA,'AVERAGE','Money_per_MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND SUM(INDHEAT_DHUSER, INDHEAT_IDH_SUMST(INDHEAT_IA,INDHEAT_DHUSER)))=
SUM((S,T),IDVH_PRICE_YCRAST(Y,C,IR,INDHEAT_IA,S,T,'Money_per_MWh')/(IWEIGHSUMS*IWEIGHSUMT/(WEIGHT_S(S)*WEIGHT_T(T))));


**END OF HOURLY INDIVIDUAL HEATING PRICE
$label noindividualheat
* ------------- END OF COMMODITY PRICES --------------


* ------------- COSTS --------------

* -- GENERATION COSTS -----

** GENERATION INVESTMENTS

ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_CAPITAL_COSTS','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
         OMONEY*
         (VGKN.L(Y,IA,G)*GINVCOST(IA,G)*ANNUITYCG(C,G)*SUM(IYALIAS2$(ORD(IYALIAS2) EQ ORD(Y)),IYHASANNUITYG(Y,IYALIAS2,G))
*investments in previous years
         + SUM(IYALIAS2$(ORD(IYALIAS2) LT ORD(Y)), VGKN.L(IYALIAS2,IA,G)*GINVCOST(IA,G)*ANNUITYCG(C,G)*IYHASANNUITYG(IYALIAS2,Y,G))
         );

$ifi %INDHEAT%==yes ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_CAPITAL_COSTS','INDIVIDUAL_HEAT','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND INDHEAT_IGF(INDHEAT_G,FFF) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
$ifi %INDHEAT%==yes          OMONEY*(
$ifi %INDHEAT%==yes          INDHEAT_VGKN.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)*INDHEAT_GDATA(INDHEAT_G,'GDINVCOST0')*INDHEAT_ANNUITYCG(C,INDHEAT_G)*SUM(IYALIAS2$(ORD(IYALIAS2) EQ ORD(Y)),INDHEAT_IYHASANNUITYG(Y,IYALIAS2,INDHEAT_G))
$ifi %INDHEAT%==yes *investments in previous years
$ifi %INDHEAT%==yes          + SUM(IYALIAS2$(ORD(IYALIAS2) LT ORD(Y)), INDHEAT_VGKN.L(IYALIAS2,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)*INDHEAT_GDATA(INDHEAT_G,'GDINVCOST0')*INDHEAT_ANNUITYCG(C,INDHEAT_G)*INDHEAT_IYHASANNUITYG(IYALIAS2,Y,INDHEAT_G))
$ifi %INDHEAT%==yes          );

** GENEARTION FIXED COSTS

ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_FIXED_COSTS','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(G,FFF) AND IAGK_HASORPOT(Y,IA,G) AND GTECH_TYPE(G,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
         OMONEY/IOF1000*GOMFCOST(IA,G)*(
         GKFX(Y,IA,G)
         +VGKNACCUMNET.L(Y,IA,G)
$ifi %DECOM%==yes         -VDECOM_EXO_ACCUM.L(Y,IA,G)$IGDECOMEXOPOT(Y,IA,G)
         );

$ifi %INDHEAT%==yes ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_FIXED_COSTS','INDIVIDUAL_HEAT','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND INDHEAT_IGF(INDHEAT_G,FFF) AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
$ifi %INDHEAT%==yes         OMONEY/IOF1000*INDHEAT_GDATA(INDHEAT_G,'GDOMFCOST0')*(
$ifi %INDHEAT%==yes         INDHEAT_GKFX(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
$ifi %INDHEAT%==yes         +INDHEAT_VGKNACCUMNET.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)  );
** GENERATION O&M COSTS

ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_OPERATIONAL_COSTS','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(G,FFF) and IAGK_HASORPOT(Y,IA,G) AND GTECH_TYPE(G,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
   OMONEY/IOF1000000*
   ( GOMVCOSTO(IA,G) * SUM((S,T), IHOURSINST(S,T)*VGE_T.L(Y,IA,G,S,T)$IGKE(G))

   +  GOMVCOSTO(IA,G) * SUM((S,T), IHOURSINST(S,T)*GDATA(G,'GDCV')*VGH_T.L(Y,IA,G,S,T)$IGKH(G))

$ifi %VGF%==ST     + GOMVCOSTIN(IA,G) * SUM((S,T), IHOURSINST(S,T)*VGF_T.L(Y,IA,G,S,T)
$ifi %VGF%==Y      + GOMVCOSTIN(IA,G) * VGF_T.L(Y,IA,G)
);


$ifi %INDHEAT%==yes ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_OPERATIONAL_COSTS','INDIVIDUAL_HEAT','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND INDHEAT_IGF(INDHEAT_G,FFF) and INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
$ifi %INDHEAT%==yes     OMONEY/IOF1000000*INDHEAT_GDATA(INDHEAT_G,'GDOMVCOST0')* SUM((INDHEAT_DHUSER,S,T), IHOURSINST(S,T)* INDHEAT_VGH_T.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_G,INDHEAT_GROUP,S,T)
$ifi %INDHEAT%==yes $ifi not %COMBTECH%==yes $goto endcombtechOMVCOST
$ifi %INDHEAT%==yes        +SUM(INDHEAT_GALIAS$(INDHEAT_GGCOMB(INDHEAT_G,INDHEAT_GALIAS)),
$ifi %INDHEAT%==yes $ifi not %HYDROGEN1%==yes $goto endhydrogenQOBJ1OMVCOST
$ifi %INDHEAT%==yes         (1+INDHEAT_HYDROGEN_H2TOF(INDHEAT_GALIAS)$(INDHEAT_GDATA(INDHEAT_GALIAS,'GDFUEL') EQ THERMGAS_H2 OR INDHEAT_GDATA(INDHEAT_GALIAS,'GDFUEL') EQ BIOGAS_H2))*
$label endhydrogenQOBJ1OMVCOST
$ifi %INDHEAT%==yes          INDHEAT_VGH_T.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_GALIAS,INDHEAT_GROUP,S,T) )
$label endcombtechOMVCOST
$ifi %INDHEAT%==yes         );

** GENERATION FUEL COSTS

ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_FUEL_COSTS','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(G,FFF) and IAGK_HASORPOT(Y,IA,G) AND GTECH_TYPE(G,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
   OMONEY*IOF3P6/IOF1000000*(
                 FUELPRICE(Y,IA,FFF)
$ifi not %STEPWISEPRICE%==yes $goto No_STEPWISEPRICE
                 + (SUM((STEPWISEPRICE_L,STEPWISEPRICE_FFF(FFF)),
                 STEPWISEPRICE_FUELPRICE_STEP(Y,C,STEPWISEPRICE_L,STEPWISEPRICE_FFF)*VSTEPWISEPRICE_VGF_T_STEP.L(Y,C,STEPWISEPRICE_L,STEPWISEPRICE_FFF))
                 /SUM((STEPWISEPRICE_L,STEPWISEPRICE_FFF(FFF)),VSTEPWISEPRICE_VGF_T_STEP.L(Y,C,STEPWISEPRICE_L,STEPWISEPRICE_FFF)))$(SUM((STEPWISEPRICE_L,STEPWISEPRICE_FFF(FFF)),VSTEPWISEPRICE_VGF_T_STEP.L(Y,C,STEPWISEPRICE_L,STEPWISEPRICE_FFF)))
$label No_STEPWISEPRICE
                 )*
   (
$ifi %VGF%==ST                 SUM((S,T), IHOURSINST(S,T) * VGF_T.L(Y,IA,G,S,T) )$IAGK_HASORPOT(Y,IA,G)
$ifi %VGF%==Y                  VGF_T.L(Y,IA,G)$IAGK_HASORPOT(Y,IA,G)
    )$(IGNOTETOH(G) and (not IGESTO(G)) and (not IGHSTO(G)) and (not IGESTOS(G)) and (not IGHSTOS(G)))

* Cost of fuel consumption during the year for steam reforming plants:
$ifi %HYDROGEN%==yes    + OMONEY/IOF1000000*FUELPRICE(Y,IA,FFF) * IOF3P6 * SUM((S,T), IHOURSINST(S,T) *VHYDROGEN_GH2_T.L(Y,IA,G,S,T)/(GDATA(G,'GDFE')))$(IHYDROGEN_GCH4TOH2(G))
;

ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','OTHER_FUEL_COSTS','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(G,FFF) and IAGK_HASORPOT(Y,IA,G) AND GTECH_TYPE(G,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
* Electricity storages:
    OMONEY/IOF1000000*SUM((S,T), EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh')*VESTOLOADT.L(Y,IA,G,S,T))$IGESTO(G)
    +OMONEY/IOF1000000*SUM((S,T), EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh')*VESTOLOADTS.L(Y,IA,G,S,T))$IGESTOS(G)
* Heat storages:
    +OMONEY/IOF1000000*SUM((S,T), DH_PRICE_YCRAST(Y,C,IR,IA,S,T,'Money_per_MWh')*VHSTOLOADT.L(Y,IA,G,S,T))$IGHSTO(G)
    +OMONEY/IOF1000000*SUM((S,T), DH_PRICE_YCRAST(Y,C,IR,IA,S,T,'Money_per_MWh')*VHSTOLOADTS.L(Y,IA,G,S,T))$IGHSTOS(G)
* Electricity to heat:
    +OMONEY/IOF1000000*SUM((S,T), EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh')*VGE_T.L(Y,IA,G,S,T))$(IAGK_HASORPOT(Y,IA,G) and IGETOH(G))
;

$ifi %INDHEAT%==yes ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_FUEL_COSTS','INDIVIDUAL_HEAT','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND INDHEAT_IGF(INDHEAT_G,FFF) and INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
$ifi %INDHEAT%==yes    OMONEY*IOF3P6/IOF1000000*(  FUELPRICE(Y,INDHEAT_IA,FFF)
$ifi %INDHEAT%==yes $ifi not %STEPWISEPRICE%==yes $goto No_STEPWISEPRICE_FCOST
$ifi %INDHEAT%==yes                  + (SUM((STEPWISEPRICE_L,STEPWISEPRICE_FFF(FFF)),
$ifi %INDHEAT%==yes                  STEPWISEPRICE_FUELPRICE_STEP(Y,C,STEPWISEPRICE_L,STEPWISEPRICE_FFF)*VSTEPWISEPRICE_VGF_T_STEP.L(Y,C,STEPWISEPRICE_L,STEPWISEPRICE_FFF))
$ifi %INDHEAT%==yes                  /SUM((STEPWISEPRICE_L,STEPWISEPRICE_FFF(FFF)),VSTEPWISEPRICE_VGF_T_STEP.L(Y,C,STEPWISEPRICE_L,STEPWISEPRICE_FFF)))$( SUM((STEPWISEPRICE_L,STEPWISEPRICE_FFF(FFF)),VSTEPWISEPRICE_VGF_T_STEP.L(Y,C,STEPWISEPRICE_L,STEPWISEPRICE_FFF)))
$label No_STEPWISEPRICE_FCOST
$ifi %INDHEAT%==yes                  )*
$ifi %INDHEAT%==yes    (
$ifi %INDHEAT%==yes $ifi %VGF%==ST                 SUM((S,T), IHOURSINST(S,T) * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T) )$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
$ifi %INDHEAT%==yes $ifi %VGF%==Y                  INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
$ifi %INDHEAT%==yes     )$((not INDHEAT_IGETOH(INDHEAT_G)) and (not INDHEAT_IGHSTO(INDHEAT_G)));
* Heat storages:
$ifi %INDHEAT%==yes ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','OTHER_FUEL_COSTS','INDIVIDUAL_HEAT','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND INDHEAT_IGF(INDHEAT_G,FFF) and INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
$ifi %INDHEAT%==yes     +OMONEY/IOF1000000*SUM((S,T,INDHEAT_DHUSER),IHOURSINST(S,T) * IDVH_PRICE_YCRAST(Y,C,IR,INDHEAT_IA,S,T,'Money_per_MWh')*INDHEAT_VHSTOLOADT.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_G,INDHEAT_GROUP,S,T))$INDHEAT_IGHSTO(INDHEAT_G)
* Electricity to heat:
$ifi %INDHEAT%==yes     +OMONEY/IOF1000000*SUM((S,T,INDHEAT_DHUSER),IHOURSINST(S,T) *EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh')*(INDHEAT_VGH_T.L(Y,INDHEAT_IA,INDHEAT_DHUSER,INDHEAT_G,INDHEAT_GROUP,S,T)/(INDHEAT_GDATA(INDHEAT_G,'GDFE')$(INDHEAT_IGETOH_NOTHP(INDHEAT_G))+INDHEAT_COP(INDHEAT_IA,INDHEAT_G,S,T)$(INDHEAT_IGHP(INDHEAT_G))) ))$(INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) and INDHEAT_IGETOH(INDHEAT_G));

** Hydro with storage seasonal price profile

ECO_G_YCRAG(Y,C,IR,IA,IGHYRS,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_HYDRO','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(IGHYRS,FFF) and IAGK_HASORPOT(Y,IA,IGHYRS) AND GTECH_TYPE(IGHYRS,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
   OMONEY/IOF1000000*
    SUM((S,T), HYPPROFILS(IA,S)* IHOURSINST(S,T)* VGE_T.L(Y,IA,IGHYRS,S,T))$IAGK_HASORPOT(Y,IA,IGHYRS);

** CO2 EMISSIONS COST
ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_CO2_TAX','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(G,FFF) and IAGK_HASORPOT(Y,IA,G) AND GTECH_TYPE(G,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
$ifi %VGF%==ST         OMONEY/IOF1000000*IM_CO2(G)*IOF0001 * IOF3P6 *M_POL(Y,"TAX_CO2",C) * SUM((S,T), IHOURSINST(S,T)*VGF_T.L(Y,IA,G,S,T))$IAGK_HASORPOT(Y,IA,G)
$ifi %VGF%==Y          OMONEY/IOF1000000*IM_CO2(G)*IOF0001 * IOF3P6 *M_POL(Y,"TAX_CO2",C) * VGF_T.L(Y,IA,G)$IAGK_HASORPOT(Y,IA,G)

$ifi %HYDROGEN%==yes     + OMONEY/IOF1000000*IM_CO2(G)*IOF0001 * IOF3P6*M_POL(Y,"TAX_CO2",C) *SUM((S,T), IHOURSINST(S,T) *VHYDROGEN_GH2_T.L(Y,IA,G,S,T) /GDATA(G,'GDFE') )$(IHYDROGEN_GCH4TOH2(G))
;

$ifi %INDHEAT%==yes ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_CO2_TAX','INDIVIDUAL_HEAT','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND INDHEAT_IGF(INDHEAT_G,FFF) and INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
$ifi %INDHEAT%==yes $ifi %VGF%==ST         OMONEY/IOF1000000*FDATA(FFF,'FDCO2')*IOF0001 * IOF3P6 *INDHEAT_M_POL(Y,'TAX_CO2',C) * SUM((S,T), IHOURSINST(S,T)*INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T))$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
$ifi %INDHEAT%==yes $ifi %VGF%==Y          OMONEY/IOF1000000*FDATA(FFF,'FDCO2')*IOF0001 * IOF3P6 *INDHEAT_M_POL(Y,'TAX_CO2',C)* INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
;

** OTHER EMISSIONS COST
ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_OTHER_EMI_TAX','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(G,FFF) AND GTECH_TYPE(G,TECH_TYPE) and IAGK_HASORPOT(Y,IA,G) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
         OMONEY/IOF1000000*(
$ifi %VGF%==ST          SUM((S,T), IHOURSINST(S,T) * (FDATA(FFF,'FDSO2')*IOF0001) * IOF3P6 * VGF_T.L(Y,IA,G,S,T))*M_POL(Y,"TAX_SO2",C)
$ifi %VGF%==ST          + SUM((S,T), IHOURSINST(S,T) * (GDATA(G,'GDNOX')*IOF0000001) * IOF3P6 * VGF_T.L(Y,IA,G,S,T))* M_POL(Y,"TAX_NOX",C)
$ifi %VGF%==Y           (FDATA(FFF,'FDSO2')*IOF0001) * IOF3P6 * VGF_T.L(Y,IA,G)*M_POL(Y,"TAX_SO2",C)
$ifi %VGF%==Y          +  (GDATA(G,'GDNOX')*IOF0000001) * IOF3P6 * VGF_T.L(Y,IA,G)* M_POL(Y,"TAX_NOX",C)
          );

$ifi %INDHEAT%==yes ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_OTHER_EMI_TAX','INDIVIDUAL_HEAT','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND INDHEAT_IGF(INDHEAT_G,FFF) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE) and INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP))=
$ifi %INDHEAT%==yes          OMONEY/IOF1000000*(
$ifi %INDHEAT%==yes $ifi %VGF%==ST          SUM((S,T,SECTOR), IHOURSINST(S,T) * (FDATA(FFF,'FDSO2')*IOF0001) * IOF3P6 * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T)*INDHEAT_M_POL(Y,'TAX_SO2',C))
$ifi %INDHEAT%==yes $ifi %VGF%==ST          + SUM((S,T,SECTOR), IHOURSINST(S,T) * (INDHEAT_GDATA(INDHEAT_G,'GDNOX')*IOF0000001) * IOF3P6 * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T)*INDHEAT_M_POL(Y,'TAX_NOX',C))
$ifi %INDHEAT%==yes $ifi %VGF%==Y           (FDATA(FFF,'FDSO2')*IOF0001) * IOF3P6 * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)*INDHEAT_M_POL(Y,'TAX_SO2',C)
$ifi %INDHEAT%==yes $ifi %VGF%==Y          +  (INDHEAT_GDATA(INDHEAT_G,'GDNOX')*IOF0000001) * IOF3P6 * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)*INDHEAT_M_POL(Y,'TAX_NOX',C)
$ifi %INDHEAT%==yes           );

** UNIT COMMITMENT COST
$ifi not %UnitComm%==yes $goto No_UC
ECO_G_YCRAG(Y,C,IR,IA,IGUC,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_UC_COSTS','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(IGUC,FFF) AND GTECH_TYPE(IGUC,TECH_TYPE) and IAGK_HASORPOT(Y,IA,IGUC) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
OMONEY/IOF1000000*SUM((S,T), IHOURSINST(S,T)*(
                                                 VUCU.L(Y,IA,IGUC,S,T)*GDATA(IGUC,'GDUCUCOST')*GDATA(IGUC,'GDUCUNITSIZE')/CHRONOHOUR(S,T)  !! startup cost
                                                 +VUCD.L(Y,IA,IGUC,S,T)*GDATA(IGUC,'GDUCDCOST')*GDATA(IGUC,'GDUCUNITSIZE')/CHRONOHOUR(S,T)  !! shutdown cost
                                                 +VUCON.L(Y,IA,IGUC,S,T)*GDATA(IGUC,'GDUCCOST0')*GDATA(IGUC,'GDUCUNITSIZE') !! fixed hourly cost
$ifi %STEPWISE_RAMPING_UC%==ramp_const_cost      +SUM(RAMPING_RATE,(VRAMPING_DOWN.L(Y,IA,IGUC,RAMPING_RATE,S,T)*IRAMPING_G_COSTS_DOWN(IGUC,RAMPING_RATE)+VRAMPING_UP.L(Y,IA,IGUC,RAMPING_RATE,S,T)*IRAMPING_G_COSTS_UP(IGUC,RAMPING_RATE))/CHRONOHOUR(S,T))  !! ramping cost
))
;
$label NO_UC


*TAXES
$ifi NOT %TAXES%==yes  $goto No_TAXES
ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_TAXES','POWER_DH','Mmoney')$(CCCRRR(C,IR) AND IGF(G,FFF) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND GTECH_TYPE(G,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
OMONEY/IOF1000000*(
* Tax(+)/subsidy(-) on fuel use for electricity generation
    + SUM((S,T),
         IHOURSINST(S,T) * TAX_F_EL(Y,C,G)  * VGE_T.L(Y,IA,G,S,T)/ (GDATA(G,'GDFE') * (1$(NOT GEFFRATE(IA,G))+GEFFRATE(IA,G))))
* Tax(+)/subsidy(-) on fuel use for heat generation
    + SUM((S,T),
         IHOURSINST(S,T) * TAX_F_HEAT(Y,C,G) * GDATA(G,'GDCV') * VGH_T.L(Y,IA,G,S,T)/ (GDATA(G,'GDFE') * (1$(NOT GEFFRATE(IA,G))+GEFFRATE(IA,G))))
* Tax(+)/subsidy(-) on fuel use
$ifi %VGF%==ST     + SUM((S,T),IHOURSINST(S,T) * TAX_F(Y,C,G)  * VGF_T.L(Y,IA,G,S,T))
$ifi %VGF%==Y      + TAX_F(Y,C,G)  * VGF_T.L(Y,IA,G)
* Tax(+)/subsidy(-) on heat generation
    + SUM((S,T),
         IHOURSINST(S,T) * TAX_G_HEAT(Y,C,G)  * VGH_T.L(Y,IA,G,S,T))
* Tax(+)/subsidy(-) on electricity generation
    + SUM((S,T),
         IHOURSINST(S,T) * TAX_G_EL(Y,C,G)  * VGE_T.L(Y,IA,G,S,T))
)
;

$ifi %INDHEAT%==yes ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_TAXES','INDIVIDUAL_HEAT','Mmoney')$(CCCRRR(C,IR) AND INDHEAT_IGF(INDHEAT_G,FFF) and RRRAAA(IR,INDHEAT_IA) and INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP) AND INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE))=
* Tax(+)/subsidy(-) on fuel use
$ifi %INDHEAT%==yes                    OMONEY/IOF1000000*(
$ifi %INDHEAT%==yes $ifi %VGF%==ST     + SUM((S,T),IHOURSINST(S,T) * INDHEAT_TAX_F(Y,INDHEAT_IA,INDHEAT_G)  * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T)));
$ifi %INDHEAT%==yes $ifi %VGF%==Y      + INDHEAT_TAX_F(Y,INDHEAT_IA,INDHEAT_G)  * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP));

$label NO_TAXES

*GRID TARIFFS
$ifi NOT %GRIDTARIFFS%==yes  $goto No_GRIDTARIFFS
ECO_G_YCRAG(Y,C,IR,IA,IGETOH,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_GRID_TARIFFS','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND IGF(IGETOH,FFF) and IAGK_HASORPOT(Y,IA,IGETOH) AND GTECH_TYPE(IGETOH,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
OMONEY/IOF1000000*(
* Fixed component and subscribed power (per MW installed)
                 + IOF1000 *
                         IGR_PRICE_TECH(Y,IR,'GRDSUBS')  * (VGKNACCUMNET.L(Y,IA,IGETOH)
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM.L(Y,IA,IGETOH)$IGDECOMEXOPOT(Y,IA,IGETOH)
                          + GKFX(Y,IA,IGETOH)) /(GDATA(IGETOH,'GDFE') *(1$(NOT GEFFRATE(IA,IGETOH))+GEFFRATE(IA,IGETOH)))
* Energy charge winter
                 + SUM((S,T)$IGR_TIME('GRDECW',IR,S,T), IHOURSINST(S,T) * IGR_PRICE_TECH(Y,IR,'GRDECW')  * VGE_T.L(Y,IA,IGETOH,S,T))
* Energy charge summer
                 + SUM((S,T)$IGR_TIME('GRDECS',IR,S,T), IHOURSINST(S,T) * IGR_PRICE_TECH(Y,IR,'GRDECS')  * VGE_T.L(Y,IA,IGETOH,S,T))
* Energy charge TOU step 1
                 + SUM((S,T)$IGR_TIME('GRDTOU1',IR,S,T), IHOURSINST(S,T) * IGR_PRICE_TECH(Y,IR,'GRDTOU1')  * VGE_T.L(Y,IA,IGETOH,S,T))
* Energy charge TOU step 2
                 + SUM((S,T)$IGR_TIME('GRDTOU2',IR,S,T),  IHOURSINST(S,T) * IGR_PRICE_TECH(Y,IR,'GRDTOU2')  * VGE_T.L(Y,IA,IGETOH,S,T))
* Energy charge TOU step 3
                 + SUM((S,T)$IGR_TIME('GRDTOU3',IR,S,T), IHOURSINST(S,T) * IGR_PRICE_TECH(Y,IR,'GRDTOU3')  * VGE_T.L(Y,IA,IGETOH,S,T))
* Energy charge TOU step 4
                 + SUM((S,T)$IGR_TIME('GRDTOU4',IR,S,T),  IHOURSINST(S,T) * IGR_PRICE_TECH(Y,IR,'GRDTOU4')  * VGE_T.L(Y,IA,IGETOH,S,T))
)
;
$label NO_GRIDTARIFFS

* -- TRANSMISSION COSTS -----
*ELECTRICITY
** TRANSMISSION INVESTMENTS COSTS
ECO_X_YCR(Y,C,IR,'COSTS','TRANSMISSION_CAPITAL_COSTS','Mmoney')$CCCRRR(C,IR)=
          OMONEY/IOF1000000*(

* Investment costs, new transmission capacity
* (the average of the annuities for the two countries in question is used for international transmission):

     SUM(IRI$IXKN(Y,IRI,IR),IOF05*VXKN.L(Y,IR,IRI)*XINVCOST(Y,IR,IRI)*
      (IOF05* (ANNUITYCX(C)+SUM(ALIAS_C$CCCRRR(ALIAS_C,IRI),ANNUITYCX(ALIAS_C))))*SUM(IYALIAS2$(ORD(IYALIAS2) EQ ORD(Y)),IYHASANNUITYX(IYALIAS2,Y)))

*Investment costs, transmission capacity invested in previous years
    + SUM((IYALIAS2,IRI)$(IXKN(IYALIAS2,IRI,IR) AND (ORD(IYALIAS2) LT ORD(Y))),IOF05*VXKN.L(IYALIAS2,IR,IRI)*XINVCOST(IYALIAS2,IR,IRI)*
      (IOF05* (ANNUITYCX(C)+SUM(ALIAS_C$CCCRRR(ALIAS_C,IRI),ANNUITYCX(ALIAS_C))))*IYHASANNUITYX(IYALIAS2,Y))
         );


ECO_X_YCR(Y,C,IR,'COSTS','TRANSMISSION_OPERATIONAL_COSTS','Mmoney')$SUM((IRI,S,T),X_FLOW_YCRST(Y,C,IR,IRI,S,T,'MWh'))=
OMONEY*IOF0000001*SUM(IRI, SUM((S,T), IHOURSINST(S,T) * (X_FLOW_YCRST(Y,C,IR,IRI,S,T,'MWh') * XCOST(IR,IRI))));

** TRANSMISSION TRADE COST
ECO_X_YCR(Y,C,IR,'COSTS','OTHER_TRADE_COSTS','Mmoney')$SUM((IRI,S,T),X_FLOW_YCRST(Y,C,IR,IRI,S,T,'MWh'))=
OMONEY*IOF0000001*SUM(IRI, SUM((S,T), IHOURSINST(S,T) * (X_FLOW_YCRST(Y,C,IR,IRI,S,T,'MWh') * EL_PRICE_YCRST(Y,C,IRI,S,T,'Money_per_MWh'))));

** TRANSMISSION TRADE INCOME
ECO_X_YCR(Y,C,IR,'REVENUE','OTHER_TRADE_INCOME','Mmoney')$SUM((IRI,S,T),X_FLOW_YCRST(Y,C,IR,IRI,S,T,'MWh'))=
OMONEY*IOF0000001*SUM(IRI, SUM((S,T), IHOURSINST(S,T) * (X_FLOW_YCRST(Y,C,IR,IRI,S,T,'MWh') * EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh'))));

* ------------- END OF COSTS --------------

* ------------- INCOME --------------

$ifi not %SUBSIDIES%==yes $goto endsubsidies
** SUBSIDIES
ECO_G_YCRAG(Y,C,IR,IA,G,TECH_TYPE,TECH_CATEGORY,'INCOME','GENERATION_SUBSIDIES','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,G) AND GTECH_TYPE(G,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
OMONEY/IOF1000000*(
* Subsidy on fuel use for electricity generation
    - SUM((S,T), SUM(IAGK_HASORPOT(Y,IA,G)$(RRRAAA(IR,IA) AND IGE(G) AND SUBSIDIES_F_EL(Y,C,G)),
         IHOURSINST(S,T) * SUBSIDIES_F_EL(Y,C,G)  * VGE_T.l(Y,IA,G,S,T)/ (GDATA(G,'GDFE') * GEFFRATE(IA,G))))
* Subsidy on fuel use for heat generation
    - SUM((S,T), SUM(IAGK_HASORPOT(Y,IA,G)$(RRRAAA(IR,IA) AND IGH(G) AND SUBSIDIES_F_HEAT(Y,C,G)),
         IHOURSINST(S,T) * SUBSIDIES_F_HEAT(Y,C,G) * GDATA(G,'GDCV') * VGH_T.l(Y,IA,G,S,T)/ (GDATA(G,'GDFE') * GEFFRATE(IA,G))))
* Subsidy on fuel use
$ifi %VGF%==ST     - SUM((S,T), SUM(IAGK_HASORPOT(Y,IA,G)$(RRRAAA(IR,IA) AND SUBSIDIES_F(Y,C,G)), IHOURSINST(S,T) * SUBSIDIES_F(Y,C,G)  * VGF_T.l(Y,IA,G,S,T)))
$ifi %VGF%==Y      - SUM(IAGK_HASORPOT(Y,IA,G)$(RRRAAA(IR,IA) AND SUBSIDIES_F(Y,C,G)), SUBSIDIES_F(Y,C,G)  * VGF_T.l(Y,IA,G))
* Subsidy on heat generation
    - SUM((S,T), SUM(IAGK_HASORPOT(Y,IA,G)$(RRRAAA(IR,IA) AND SUBSIDIES_G_HEAT(Y,C,G)),
         IHOURSINST(S,T) * SUBSIDIES_G_HEAT(Y,C,G)  * VGH_T.l(Y,IA,G,S,T)))
* Subsidy on electricity generation
    - SUM((S,T), SUM(IAGK_HASORPOT(Y,IA,G)$(RRRAAA(IR,IA) AND SUBSIDIES_G_EL(Y,C,G)),
         IHOURSINST(S,T) * SUBSIDIES_G_EL(Y,C,G)  * VGE_T.l(Y,IA,G,S,T)))
* Subsidy on electricity consumption
    - SUM((DEUSER), SUBSIDIES_DE(C,DEUSER) * DE(Y,IR,DEUSER))
* Subsidy on heat consumption
    - SUM((DHUSER), SUBSIDIES_DH(C,DHUSER) * DH(Y,IA,DHUSER))
);
$label endsubsidies

* ------------- END OF INCOME --------------
* ------------- OBJECTIVE FUNCTION --------------

*GENERATION COSTS
OBJ_YCR(Y,C,IR,'GENERATION_CAPITAL_COSTS','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_CAPITAL_COSTS','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_FIXED_COSTS','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_FIXED_COSTS','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_OPERATIONAL_COSTS','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_OPERATIONAL_COSTS','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_FUEL_COSTS','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_FUEL_COSTS','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_HYDRO','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_HYDRO','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_CO2_TAX','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_CO2_TAX','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_OTHER_EMI_TAX','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_OTHER_EMI_TAX','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_UC_COSTS','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_UC_COSTS','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_TAXES','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_TAXES','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_SUBSIDIES','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_SUBSIDIES','POWER_DH','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_GRID_TARIFFS','POWER_DH','Mmoney')$CCCRRR(C,IR)=  SUM((IA,G,FFF,TECH_TYPE,TECH_CATEGORY)$(RRRAAA(IR,IA)AND IAGK_HASORPOT(Y,IA,G)),ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS','GENERATION_GRID_TARIFFS','POWER_DH','Mmoney'));
*TRANSMISSION COSTS
OBJ_YCR(Y,C,IR,'TRANSMISSION_CAPITAL_COSTS','POWER_DH','Mmoney')$CCCRRR(C,IR)=   ECO_X_YCR(Y,C,IR,'COSTS','TRANSMISSION_CAPITAL_COSTS','Mmoney');
OBJ_YCR(Y,C,IR,'TRANSMISSION_OPERATIONAL_COSTS','POWER_DH','Mmoney')$CCCRRR(C,IR)=   ECO_X_YCR(Y,C,IR,'COSTS','TRANSMISSION_OPERATIONAL_COSTS','Mmoney');

$ifi NOT %INDHEAT%==yes  $goto endindheatobj
OBJ_YCR(Y,C,IR,'GENERATION_CAPITAL_COSTS','INDIVIDUAL_HEAT','Mmoney')$CCCRRR(C,IR)=  SUM((INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP)$(RRRAAA(IR,INDHEAT_IA)AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)),ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_CAPITAL_COSTS','INDIVIDUAL_HEAT','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_FIXED_COSTS','INDIVIDUAL_HEAT','Mmoney')$CCCRRR(C,IR)=  SUM((INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP)$(RRRAAA(IR,INDHEAT_IA)AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)), ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_FIXED_COSTS','INDIVIDUAL_HEAT','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_OPERATIONAL_COSTS','INDIVIDUAL_HEAT','Mmoney')$CCCRRR(C,IR)=  SUM((INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP)$(RRRAAA(IR,INDHEAT_IA)AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)), ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_OPERATIONAL_COSTS','INDIVIDUAL_HEAT','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_FUEL_COSTS','INDIVIDUAL_HEAT','Mmoney')$CCCRRR(C,IR)=  SUM((INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP)$(RRRAAA(IR,INDHEAT_IA)AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)), ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_FUEL_COSTS','INDIVIDUAL_HEAT','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_CO2_TAX','INDIVIDUAL_HEAT','Mmoney')$CCCRRR(C,IR)=  SUM((INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP)$(RRRAAA(IR,INDHEAT_IA)AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)), ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_CO2_TAX','INDIVIDUAL_HEAT','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_OTHER_EMI_TAX','INDIVIDUAL_HEAT','Mmoney')$CCCRRR(C,IR)=  SUM((INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP)$(RRRAAA(IR,INDHEAT_IA)AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)), ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_OTHER_EMI_TAX','INDIVIDUAL_HEAT','Mmoney'));
OBJ_YCR(Y,C,IR,'GENERATION_TAXES','INDIVIDUAL_HEAT','Mmoney')$CCCRRR(C,IR)=  SUM((INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP)$(RRRAAA(IR,INDHEAT_IA)AND INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)), ECO_G_YCRAG(Y,C,IR,INDHEAT_IA,INDHEAT_G,FFF,TECH_TYPE,INDHEAT_GROUP,'COSTS','GENERATION_TAXES','INDIVIDUAL_HEAT','Mmoney'));
$label endindheatobj

*CONSUMER_GRID_TARIFFS, CONSUMER_TAXES, EV_COSTS, DR_COSTS
$include "../../base/addons/_hooks/outputsummary_obj.inc"


* ------------- END OF OBJECTIVE FUNCTION --------------

* ------------- REVENUE --------------

** ELECTRICITY SALES
ECO_G_YCRAG(Y,C,IR,IA,IGE,FFF,TECH_TYPE,TECH_CATEGORY,'REVENUE','ELECTRICITY_SALE','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGE) AND IGF(IGE,FFF) AND GTECH_TYPE(IGE,TECH_TYPE) and IGNOTETOH(IGE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
 OMONEY*IOF0000001*
   SUM((S,T), IHOURSINST(S,T)*VGE_T.L(Y,IA,IGE,S,T)*EL_PRICE_YCRST(Y,C,IR,S,T,'Money_per_MWh'))
;

** HEAT SALES
ECO_G_YCRAG(Y,C,IR,IA,IGH,FFF,TECH_TYPE,TECH_CATEGORY,'REVENUE','HEAT_SALE','POWER_DH','Mmoney')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and IAGK_HASORPOT(Y,IA,IGH) AND IGF(IGH,FFF) AND GTECH_TYPE(IGH,TECH_TYPE) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
 OMONEY*IOF0000001*
   SUM((S,T), IHOURSINST(S,T)*VGH_T.L(Y,IA,IGH,S,T)*DH_PRICE_YCRAST(Y,C,IR,IA,S,T,'Money_per_MWh'))
;

ECO_G_YCRAG(Y,C,IR,IA,IGE,FFF,TECH_TYPE,TECH_CATEGORY,'REVENUE','ELECTRICITY_SPECIFIC_REVENUE','POWER_DH','Money_per_MWh')$(IAGK_HASORPOT(Y,IA,IGE) AND PRO_YCRAGF(Y,C,IR,IA,IGE,FFF,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'TWh') ) =
ECO_G_YCRAG(Y,C,IR,IA,IGE,FFF,TECH_TYPE,TECH_CATEGORY,'REVENUE','ELECTRICITY_SALE','POWER_DH','Mmoney') / PRO_YCRAGF(Y,C,IR,IA,IGE,FFF,'ELECTRICITY',TECH_TYPE,TECH_CATEGORY,'TWh');

ECO_G_YCRAG(Y,C,IR,IA,IGH,FFF,TECH_TYPE,TECH_CATEGORY,'REVENUE','DISTRICT_HEAT_SPECIFIC_REVENUE','POWER_DH','Money_per_MWh')$(IAGK_HASORPOT(Y,IA,IGH) AND PRO_YCRAGF(Y,C,IR,IA,IGH,FFF,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'TWh') ) =
ECO_G_YCRAG(Y,C,IR,IA,IGH,FFF,TECH_TYPE,TECH_CATEGORY,'REVENUE','HEAT_SALE','POWER_DH','Mmoney') / PRO_YCRAGF(Y,C,IR,IA,IGH,FFF,'DISTRICT_HEAT',TECH_TYPE,TECH_CATEGORY,'TWh');

* ------------- END OF REVENUE --------------

* ------------- PROFIT --------------
ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'PROFIT','TOTAL_PROFIT','POWER_DH','Mmoney')$IAGK_HASORPOT(Y,IA,G)=
SUM(SUBCATEGORY, ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'REVENUE',SUBCATEGORY,'POWER_DH','Mmoney')-ECO_G_YCRAG(Y,C,IR,IA,G,FFF,TECH_TYPE,TECH_CATEGORY,'COSTS',SUBCATEGORY,'POWER_DH','Mmoney')
);


* ------------- END OF PROFIT --------------

* ------------- FUEL PRICE --------------
FUEL_PRICE_YCRAF(Y,C,IR,AAA,FFF,'POWER_DH','Money_per_MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,AAA) AND IA(AAA)
$ifi %INDHEAT%==yes                                        AND NOT INDHEAT_AAA(AAA)
                                                         )=FUELPRICE(Y,AAA,FFF)*IOF3P6*OMONEY;
FUEL_PRICE_YCRAF(Y,C,IR,AAA,FFF,'POWER_DH','Money_per_GJ')$(CCCRRR(C,IR) AND RRRAAA(IR,AAA) AND IA(AAA)
$ifi %INDHEAT%==yes                                        AND NOT INDHEAT_AAA(AAA)
                                                         )=FUELPRICE(Y,AAA,FFF)*OMONEY;

$ifi NOT %INDHEAT%==yes  $goto endindheatfuelprice
FUEL_PRICE_YCRAF(Y,C,IR,INDHEAT_IA,FFF,SECTOR,'Money_per_MWh')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND INDHEAT_AAAINSECTOR(INDHEAT_IA,SECTOR))= FUELPRICE(Y,INDHEAT_IA,FFF)*IOF3P6*OMONEY;
FUEL_PRICE_YCRAF(Y,C,IR,INDHEAT_IA,FFF,SECTOR,'Money_per_GJ')$(CCCRRR(C,IR) AND RRRAAA(IR,INDHEAT_IA) AND INDHEAT_AAAINSECTOR(INDHEAT_IA,SECTOR))= FUELPRICE(Y,INDHEAT_IA,FFF)*OMONEY;
$label endindheatfuelprice
* ------------- END OF FUEL PRICE --------------

* --------- END OF ECONOMIC OUTPUT -----------

* ---------------------- ENVIRONMENT ----------------------

* ------------- EMISSIONS -------------

EMI_YCRAG(Y,C,IR,IA,FFF,TECH_TYPE,TECH_CATEGORY,'CO2','POWER_DH','kton')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
                 SUM(G$IAGK_HASORPOT(Y,IA,G),
$ifi %VGF%==ST         IM_CO2(G)*IOF0000001 * IOF3P6 * SUM((S,T), IHOURSINST(S,T)*VGF_T.L(Y,IA,G,S,T))
$ifi %VGF%==Y          IM_CO2(G)*IOF0000001 * IOF3P6 * VGF_T.L(Y,IA,G)
                 *IGF(G,FFF) * GTECH_TYPE(G,TECH_TYPE));


EMI_YCRAG(Y,C,IR,IA,FFF,TECH_TYPE,TECH_CATEGORY,'SO2','POWER_DH','kton')$(CCCRRR(C,IR) and RRRAAA(IR,IA) and FDATA(FFF,'FDSO2')  AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
                 SUM(G$IAGK_HASORPOT(Y,IA,G),
$ifi %VGF%==ST          SUM((S,T), IHOURSINST(S,T) * (FDATA(FFF,'FDSO2')*IOF0001) * IOF3P6 * VGF_T.L(Y,IA,G,S,T))
$ifi %VGF%==Y           (FDATA(FFF,'FDSO2')*IOF0001) * IOF3P6 * VGF_T.L(Y,IA,G)
                 *IGF(G,FFF) * GTECH_TYPE(G,TECH_TYPE));


EMI_YCRAG(Y,C,IR,IA,FFF,TECH_TYPE,TECH_CATEGORY,'NOX','POWER_DH','kton')$(CCCRRR(C,IR) and RRRAAA(IR,IA) AND TECH_TYPE_CATEGORY(TECH_TYPE,TECH_CATEGORY))=
                 SUM(G$IAGK_HASORPOT(Y,IA,G),
$ifi %VGF%==ST         SUM((S,T), IHOURSINST(S,T) * (GDATA(G,'GDNOX')*IOF0000001) * IOF3P6 * VGF_T.L(Y,IA,G,S,T))
$ifi %VGF%==Y          (GDATA(G,'GDNOX')*IOF0000001) * IOF3P6 * VGF_T.L(Y,IA,G)
                 *IGF(G,FFF) * GTECH_TYPE(G,TECH_TYPE));


$ifi NOT %INDHEAT%==yes  $goto endindheatemi
EMI_YCRAG(Y,C,IR,INDHEAT_IA,FFF,TECH_TYPE,INDHEAT_GROUP,'CO2','INDIVIDUAL_HEAT','kton')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) )=
                 SUM(INDHEAT_G$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP),
$ifi %VGF%==ST         FDATA(FFF,'FDCO2')*IOF0000001 * IOF3P6 * * SUM((S,T), IHOURSINST(S,T)*INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T))
$ifi %VGF%==Y          FDATA(FFF,'FDCO2')*IOF0000001 * IOF3P6 * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
                 *INDHEAT_IGF(INDHEAT_G,FFF) *INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE));

EMI_YCRAG(Y,C,IR,INDHEAT_IA,FFF,TECH_TYPE,INDHEAT_GROUP,'SO2','INDIVIDUAL_HEAT','kton')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA) AND FDATA(FFF,'FDSO2') )=
                 SUM(INDHEAT_G$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP),
$ifi %VGF%==ST          SUM((S,T), IHOURSINST(S,T) * (FDATA(FFF,'FDSO2')*IOF0001) * IOF3P6 * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T))
$ifi %VGF%==Y           (FDATA(FFF,'FDSO2')*IOF0001) * IOF3P6 * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
                 *INDHEAT_IGF(INDHEAT_G,FFF) *INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE));

EMI_YCRAG(Y,C,IR,INDHEAT_IA,FFF,TECH_TYPE,INDHEAT_GROUP,'NOX','INDIVIDUAL_HEAT','kton')$(CCCRRR(C,IR) and RRRAAA(IR,INDHEAT_IA))=
                 SUM(INDHEAT_G$INDHEAT_IAGK_HASORPOT(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP),
$ifi %VGF%==ST         SUM((S,T), IHOURSINST(S,T) * (INDHEAT_GDATA(INDHEAT_G,'GDNOX')*IOF0000001) * IOF3P6 * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP,S,T))
$ifi %VGF%==Y          (INDHEAT_GDATA(INDHEAT_G,'GDNOX')*IOF0000001) * IOF3P6 * INDHEAT_VGF_T.L(Y,INDHEAT_IA,INDHEAT_G,INDHEAT_GROUP)
                 *INDHEAT_IGF(INDHEAT_G,FFF) *INDHEAT_GTECH_TYPE(INDHEAT_G,TECH_TYPE));
$label endindheatemi

* ------------- END OF EMISSIONS -------------

* ------------- EMISSION POLICY --------------

EMI_POLICY(Y,C,'TAX_CO2','POWER_DH','Money_per_tCO2')= OMONEY*M_POL(Y,'TAX_CO2',C);
EMI_POLICY(Y,C,'TAX_SO2','POWER_DH','Money_per_tSO2')= OMONEY*M_POL(Y,'TAX_SO2',C);
EMI_POLICY(Y,C,'TAX_NOx','POWER_DH','Money_per_kgNOx')= OMONEY*M_POL(Y,'TAX_NOx',C);
EMI_POLICY(Y,C,'LIM_CO2','POWER_DH','tCO2_per_year')= M_POL(Y,'LIM_CO2',C);
EMI_POLICY(Y,C,'LIM_SO2','POWER_DH','tSO2_per_year')= M_POL(Y,'LIM_SO2',C);
EMI_POLICY(Y,C,'LIM_NOx','POWER_DH','kgNOx_per_year')= M_POL(Y,'LIM_NOx',C);

EMI_POLICY_ALL(Y,'LIM_CO2','POWER_DH','tCO2_per_year')= M_POLNA(Y,'LIM_CO2');
EMI_POLICY_ALL(Y,'LIM_SO2','POWER_DH','tSO2_per_year')= M_POLNA(Y,'LIM_SO2');
EMI_POLICY_ALL(Y,'LIM_NOx','POWER_DH','kgNOx_per_year')= M_POLNA(Y,'LIM_NOx');


$ifi NOT %INDHEAT%==yes  $goto endindheatfuelemipol
EMI_POLICY(Y,C,'TAX_CO2','INDIVIDUAL_HEAT','Money_per_tCO2')= OMONEY*(INDHEAT_M_POL(Y,'TAX_CO2',C));
EMI_POLICY(Y,C,'TAX_SO2','INDIVIDUAL_HEAT','Money_per_tSO2')= OMONEY*(INDHEAT_M_POL(Y,'TAX_SO2',C));
EMI_POLICY(Y,C,'TAX_NOx','INDIVIDUAL_HEAT','Money_per_kgNOx')= OMONEY*(INDHEAT_M_POL(Y,'TAX_NOx',C));
EMI_POLICY(Y,C,'LIM_CO2','INDIVIDUAL_HEAT','tCO2_per_year')= INDHEAT_M_POL(Y,'LIM_CO2',C);
EMI_POLICY(Y,C,'LIM_SO2','INDIVIDUAL_HEAT','tSO2_per_year')= INDHEAT_M_POL(Y,'LIM_SO2',C);
EMI_POLICY(Y,C,'LIM_NOx','INDIVIDUAL_HEAT','kgNOx_per_year')= INDHEAT_M_POL(Y,'LIM_NOx',C);

EMI_POLICY_ALL(Y,'LIM_CO2','INDIVIDUAL_HEAT','tCO2_per_year')= INDHEAT_M_POLNA(Y,'LIM_CO2');
EMI_POLICY_ALL(Y,'LIM_SO2','INDIVIDUAL_HEAT','tSO2_per_year')= INDHEAT_M_POLNA(Y,'LIM_SO2');
EMI_POLICY_ALL(Y,'LIM_NOx','INDIVIDUAL_HEAT','kgNOx_per_year')= INDHEAT_M_POLNA(Y,'LIM_NOx');
$label endindheatfuelemipol

* ------------- END OF EMISSION POLICY --------------

*--------------------------ADDITIONAL OUTPUT FROM ADDON-----------------------------

*===============Demand Response=================================================================
$ifi not %DEMANDRESPONSE%==yes $goto endDEMANDRESPONSE

PARAMETER DR_PROFIT_YCRST(Y,C,RRR,SSS,TTT,DR_TECH,UNITS);

DR_PROFIT_YCRST(Y,C,IR,S,T,DR_Tech,'Mmoney')$CCCRRR(C,IR)=OMONEY/IOF1000000*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)*SUM(IA$RRRAAA(IR,IA),VDR_DOWN.L(Y,IA,DR_TECH,S,T))
- OMONEY/IOF1000000*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)* SUM(IA$RRRAAA(IR,IA),VDR_UP.L(Y,IA,DR_TECH,S,T));


PARAMETER DR_PROFIT_YCR(Y,C,RRR,DR_TECH,UNITS);

DR_PROFIT_YCR(Y,C,IR,DR_Tech,'Mmoney')$CCCRRR(C,IR)=SUM((S,T),OMONEY/IOF1000000*IHOURSINST(S,T)*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)*SUM(IA$RRRAAA(IR,IA),VDR_DOWN.L(Y,IA,DR_TECH,S,T)))
- SUM((S,T),OMONEY/IOF1000000*IHOURSINST(S,T)*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)* SUM(IA$RRRAAA(IR,IA),VDR_UP.L(Y,IA,DR_TECH,S,T)));


$label endDEMANDRESPONSE
*===========================================================================================

*==============EV PROFITS from smart charging vs dumb charging===============================
$ifi not %EV%==yes $goto endEV
PARAMETER EV_PROFIT_YCRST(Y,C,RRR,SSS,TTT,UNITS);

EV_PROFIT_YCRST(Y,C,IR,S,T,'Mmoney')$CCCRRR(C,IR)=OMONEY/IOF1000000*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)*(EV_BEV_Dumb(Y,S,T,IR)*(1/EV_PEFF(Y)))
-OMONEY/IOF1000000*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)* VEV_VG2V_BEV.L(Y,IR,S,T)
+ OMONEY/IOF1000000*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)* (EV_PHEV_Dumb(Y,S,T,IR)*(1/EV_PEFF(Y)))
-OMONEY/IOF1000000*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)* VEV_VG2V_PHEV.L(Y,IR,S,T)
;

PARAMETER EV_PROFIT_YCR(Y,C,RRR,UNITS);

EV_PROFIT_YCR(Y,C,IR,'Mmoney')$CCCRRR(C,IR)= SUM((S,T),OMONEY/IOF1000000*IHOURSINST(S,T)*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)*(EV_BEV_Dumb(Y,S,T,IR)*(1/EV_PEFF(Y))))
-SUM((S,T),OMONEY/IOF1000000*IHOURSINST(S,T)*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)* VEV_VG2V_BEV.L(Y,IR,S,T))
+SUM((S,T),OMONEY/IOF1000000*IHOURSINST(S,T)*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)*(EV_PHEV_Dumb(Y,S,T,IR)*(1/EV_PEFF(Y))))
-SUM((S,T),OMONEY/IOF1000000*IHOURSINST(S,T)*QEEQ.M(Y,IR,S,T)
$ifi %RollingSeasons%==yes         /IHOURSINTROLLINGSEASON(S,T)
$ifi not %RollingSeasons%==yes     /IHOURSINST(S,T)
/IDISCOUNTFACTOR(Y)/IWEIGHTY(Y)* VEV_VG2V_PHEV.L(Y,IR,S,T))
;



$label endEV
*=================================================================================================

* ---------------------- END OF ENVIRONMENT ----------------------




execute_unload "../output/MainResults_%CASEID%.gdx"      G_CAP_YCRAF,G_STO_YCRAF,PRO_YCRAGFST,PRO_YCRAGF,F_CONS_YCRA,EMI_YCRAG,
X_CAP_YCR,X_FLOW_YCRST,X_FLOW_YCR,
HEAT_STORAGE_VOLUME,WEEKLY_HYDRO_STORAGE_VOLUME,
ECO_G_YCRAG,ECO_X_YCR,OBJ_YCR,
EL_PRICE_YCR,EL_PRICE_YCRST,EL_DEMAND_YCRST,EL_DEMAND_YCR,EL_NET_DEMAND_YCRST,
DH_PRICE_YCRA,DH_PRICE_YCRAST,H_DEMAND_YCRAST,H_DEMAND_YCRA,
CURT_YCRAGFST,CURT_YCRAGF,
FUEL_PRICE_YCRAF,EMI_POLICY,EMI_POLICY_ALL,  OSOLVESTAT
$ifi %Hydrogen%==yes ,GH2_T
$ifi %INDHEAT%==yes  ,PRO_IDVH_YCRAGFST,IDVH_PRICE_YCRA,IDVH_PRICE_YCRAST
$ifi %DEMANDRESPONSE%==yes ,DR_PROFIT_YCRST,DR_PROFIT_YCR
$ifi %EV%==yes ,EV_PROFIT_YCRST, EV_PROFIT_YCR

;



